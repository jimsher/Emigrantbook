<!DOCTYPE html>
<html lang="ka">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
 <title>EmigrantBook | Token Impact</title>
 <link rel="stylesheet" href="https://emigrantbook.com/token/token.css">
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
 <script src="https://js.stripe.com/v3/"></script>
 
<script src="https://download.agora.io/sdk/release/AgoraRTC_N-4.11.0.js"></script>

 <style>
:root {
 --gold: #D4AF37;
 --bg: #000000;
 --card: #1A1C1E;
 --text: #E4E6EB;
 --soft-text: #B0B3B8;
 --border: #32363B;
 --glass: rgba(255, 255, 255, 0.05);
 --red: #ff4d4d;
 --green: #2ecc71;
 }
 * { box-sizing: border-box; margin: 0; padding: 0; }
 body { background-color: #000; color: var(--text); font-family: sans-serif; overflow: hidden; height: 100vh; }
 
 /* LIVE BUTTON ANIMATION */
 .live-btn-custom {
 display: flex; align-items: center; gap: 10px; color: var(--red);
 font-weight: 900; font-size: 14px; text-transform: uppercase;
 border: 1px solid var(--red); padding: 8px 15px; border-radius: 6px;
 position: relative; transition: 0.3s;
 }
 .live-status-dot {
 width: 10px; height: 10px; background: var(--red); border-radius: 50%;
 animation: livePulse 1.5s infinite;
 }
 @keyframes livePulse {
 0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 77, 77, 0.7); }
 70% { transform: scale(1.3); box-shadow: 0 0 0 10px rgba(255, 77, 77, 0); }
 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 77, 77, 0); }
 }

 /* PROFILE CUSTOM NAVBAR & SIDEBAR */
 .profile-nav {
 display: flex; align-items: center; justify-content: space-between;
 padding: 15px; background: transparent; position: relative; z-index: 1001;
 }
 .menu-trigger {
 cursor: pointer; display: flex; flex-direction: column; gap: 4px; padding: 5px;
 }
 .menu-trigger span {
 width: 25px; height: 2px; background: var(--gold); border-radius: 2px;
 transition: 0.3s;
 }

 .side-menu {
 position: fixed; top: 0; right: -70%; width: 70%; height: 100%;
 background: rgba(10, 10, 10, 0.98); backdrop-filter: blur(15px);
 z-index: 20000; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
 border-left: 1px solid rgba(212, 175, 55, 0.1);
 display: flex; flex-direction: column; padding: 40px 20px;
 }
 .side-menu.active { right: 0; }
 .side-menu-overlay {
 position: fixed; top: 0; left: 0; width: 100%; height: 100%;
 background: rgba(0,0,0,0.5); z-index: 19999; display: none;
 }

 .menu-item {
 display: flex; align-items: center; gap: 15px; padding: 18px;
 color: var(--text); text-decoration: none; font-size: 16px;
 border-bottom: 1px solid rgba(255,255,255,0.05); transition: 0.2s;
 }
 .menu-item i { color: var(--gold); width: 20px; font-size: 18px; }
 .menu-item:active { background: var(--glass); color: var(--gold); }

 /* ELITE VIDEO STYLES */
 .elite-video {
 border: 3px solid var(--gold) !important;
 box-shadow: inset 0 0 30px rgba(212, 175, 55, 0.3), 0 0 20px rgba(212, 175, 55, 0.4);
 }

 .token-embedded-seal {
 position: absolute; top: 70px; right: 20px; width: 65px; height: 65px;
 background: url('https://emigrantbook.com/1000084015-removebg-preview.png') no-repeat center;
 background-size: contain; filter: drop-shadow(0 0 10px var(--gold)) brightness(1.2);
 z-index: 100; pointer-events: none; animation: sealGlow 2s infinite alternate;
 }

 @keyframes sealGlow {
 from { transform: scale(1) rotate(0deg); filter: drop-shadow(0 0 5px var(--gold)) brightness(1.1); }
 to { transform: scale(1.1) rotate(5deg); filter: drop-shadow(0 0 20px var(--gold)) brightness(1.4); }
 }

 .congrats-label {
 position: absolute; top: 140px; right: 12px; color: var(--gold);
 font-size: 11px; font-weight: 900; text-transform: uppercase;
 text-shadow: 0 0 10px #000; letter-spacing: 1px; z-index: 101;
 }

 
 .side-actions {
 position: absolute; right: 12px; bottom: 90px;
 display: flex; flex-direction: column; gap: 18px; align-items: center; z-index: 10;
 }
 .author-mini-ava { width: 45px; height: 45px; border-radius: 50%; border: 2px solid var(--gold); object-fit: cover; background: #222; cursor: pointer; }
 .action-item { text-align: center; cursor: pointer; transition: 0.2s; }
 .action-item i { font-size: 30px; color: #fff; filter: drop-shadow(0 0 5px #000); }
 .action-item.liked i, .action-item.saved i { color: var(--gold); }
 .action-item span { display: block; font-size: 12px; color: #fff; margin-top: 4px; font-weight: bold; }
 
 .floating-ava {
 position: absolute; left: 20px; bottom: 120px; width: 35px; height: 35px; border-radius: 50%;
 border: 2px solid var(--gold); object-fit: cover; pointer-events: none; opacity: 0; z-index: 5;
 animation: floatUp 3s ease-out forwards;
 }
 @keyframes floatUp {
 0% { transform: translateY(0) scale(0.5); opacity: 0; }
 20% { opacity: 1; }
 80% { opacity: 0.8; }
 100% { transform: translateY(-150px) scale(1.2); opacity: 0; }
 }

 .mobile-bottom-nav {
 position: fixed; bottom: 0; left: 0; width: 100%; height: 70px;
 background: var(--card); border-top: 1px solid var(--border);
 display: flex; justify-content: space-around; align-items: center; z-index: 10000;
 }
 .m-nav-item { display: flex; flex-direction: column; align-items: center; text-decoration: none; color: var(--soft-text); font-size: 11px; font-weight: bold; cursor: pointer; }
 .m-nav-item i { font-size: 26px; margin-bottom: 4px; }
 .m-nav-ava { width: 30px; height: 30px; border-radius: 50%; object-fit: cover; border: 1px solid var(--soft-text); margin-bottom: 2px; }
 .active i { color: var(--gold) !important; }
 .token-plus-btn {
 background: linear-gradient(45deg, #BF953F, #FCF6BA, #B38728);
 width: 55px; height: 35px; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-top: -5px; cursor: pointer;
 }

 .auth-overlay {
 position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
 background: radial-gradient(circle at center, #1a1a1a 0%, #000 100%);
 z-index: 50000; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 20px;
 }
 .auth-card { background: #1e1e1e; border: 1px solid #333; border-radius: 15px; padding: 25px; width: 100%; max-width: 400px; text-align: center; }
 .auth-input { width: 100%; background: #2a2a2a; border: 1px solid #444; color: white; padding: 14px; margin-bottom: 12px; border-radius: 8px; outline: none; }
 .glowing-token { font-size: 60px; font-weight: 900; color: var(--gold); animation: pulse-gold 2s infinite alternate; }
 @keyframes pulse-gold { from { transform: scale(1); } to { transform: scale(1.05); filter: brightness(1.3); } }
 .auth-logo-img { width: 130px; height: auto; margin-bottom: 10px; filter: drop-shadow(0 0 10px rgba(212, 175, 55, 0.4)); }
 
 #uploadModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 20000; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
 #discoveryUI {
 position: fixed; top: 0; left: 0; width: 100%; height: 100%;
 background: linear-gradient(135deg, #1A1C1E 0%, #000 100%);
 z-index: 15000; display: none; flex-direction: column;
 padding: 70px 20px 90px 20px; overflow-y: auto; animation: fadeIn 0.4s ease;
 }
 #profileUI {
 position: fixed; top: 0; left: 0; width: 100%; height: 100%;
 background: #000; z-index: 16000; display: none; flex-direction: column; overflow-y: auto;
 }
 .profile-header { text-align: center; margin-top: 10px; padding: 20px; }

 /* REFINED STATUS DOT & LAST SEEN */
 .profile-ava-wrapper {
 position: relative; width: 100px; height: 100px; margin: 0 auto;
 }
 .profile-ava-main { width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--gold); object-fit: cover; }
 
 .status-dot {
 position: absolute; bottom: 5px; right: 5px; width: 18px; height: 18px;
 border-radius: 50%; border: 3px solid #000; background: var(--green);
 display: none; align-items: center; justify-content: center;
 }
 .status-dot.online { display: block; animation: statusPulse 2s infinite; }
 .status-dot.offline { 
 display: flex; background: #444; width: auto; min-width: 18px; height: auto; 
 padding: 2px 4px; border-radius: 8px; bottom: 3px; right: 3px;
 }
 .last-seen-tag { font-size: 8px; color: white; font-weight: bold; }

 @keyframes statusPulse {
 0% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.7); }
 70% { box-shadow: 0 0 0 8px rgba(46, 204, 113, 0); }
 100% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0); }
 }

 .profile-stats-row { display: flex; justify-content: center; gap: 20px; margin-top: 15px; }
 .stat-box { text-align: center; cursor: pointer; }
 .stat-num { display: block; color: var(--gold); font-size: 18px; font-weight: 900; }
 .stat-label { font-size: 10px; color: var(--soft-text); text-transform: uppercase; }
 .profile-nav-menu { display: flex; justify-content: space-around; margin-top: 20px; border-top: 1px solid var(--border); padding-top: 15px; }
 .p-nav-btn { background: none; border: none; color: var(--soft-text); font-weight: bold; cursor: pointer; font-size: 13px; }
 .p-nav-btn.active { color: var(--gold); }
 .video-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; margin-top: 20px; }
 .grid-item { aspect-ratio: 9/16; background: #111; overflow: hidden; border-radius: 5px; cursor: pointer; }
 .grid-item video { width: 100%; height: 100%; object-fit: cover; }
 .profile-btn { padding: 10px 20px; border-radius: 20px; border: none; font-weight: bold; cursor: pointer; margin: 5px; }
 .btn-gold { background: var(--gold); color: #000; }
 .btn-outline { background: transparent; border: 1px solid var(--gold); color: var(--gold); }
 
 #requestsUI {
 position: fixed; top: 0; left: 0; width: 100%; height: 100%;
 background: rgba(0,0,0,0.95); z-index: 25000; display: none; flex-direction: column; padding: 20px;
 }
 .req-card { background: var(--card); border: 1px solid var(--border); padding: 15px; border-radius: 15px; display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
 #messengerUI {
 position: fixed; top: 0; left: 0; width: 100%; height: 100%;
 background: #000; z-index: 17000; display: none; flex-direction: column; padding-top: 56px;
 }
 .chat-list-item { display: flex; align-items: center; gap: 15px; padding: 15px; border-bottom: 1px solid var(--border); cursor: pointer; transition: 0.3s; }
 .chat-list-item:hover { background: var(--glass); }
 .chat-list-ava { width: 50px; height: 50px; border-radius: 50%; border: 1px solid var(--gold); }
 #individualChat {
 position: fixed; top: 0; left: 0; width: 100%; height: 100%;
 background: #000; z-index: 18000; display: none; flex-direction: column;
 }
 .chat-header { height: 60px; background: var(--card); border-bottom: 1px solid var(--border); display: flex; align-items: center; padding: 0 15px; gap: 15px; justify-content: space-between; }
 .chat-messages { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
 .msg-bubble { max-width: 75%; padding: 10px 15px; border-radius: 18px; font-size: 14px; line-height: 1.4; }
 .msg-sent { align-self: flex-end; background: var(--gold); color: #000; border-bottom-right-radius: 2px; }
 .msg-received { align-self: flex-start; background: var(--card); color: #fff; border-bottom-left-radius: 2px; }
 .chat-input-area { height: 70px; background: var(--card); padding: 10px; display: flex; align-items: center; gap: 10px; border-top: 1px solid var(--border); }
 .chat-input { flex: 1; background: #121212; border: 1px solid var(--border); border-radius: 25px; padding: 10px 15px; color: #fff; outline: none; }
 .chat-send-btn { background: var(--gold); border: none; width: 40px; height: 40px; border-radius: 50%; color: #000; cursor: pointer; }
 
 #commentsUI {
 position: fixed; bottom: 0; left: 0; width: 100%; height: 75%;
 background: rgba(15, 15, 15, 0.98); backdrop-filter: blur(25px);
 z-index: 20000; display: none; flex-direction: column;
 border-top: 1px solid var(--gold); border-radius: 30px 30px 0 0;
 animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
 }
 @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
 .comment-item { padding: 15px; border-bottom: 1px solid rgba(212, 175, 55, 0.1); }
 .comment-top { display: flex; gap: 12px; }
 .comm-ava { width: 38px; height: 38px; border-radius: 50%; border: 1px solid var(--gold); object-fit: cover; }
 .comm-body { flex: 1; }
 .comm-name { font-size: 13px; font-weight: 900; color: var(--gold); margin-bottom: 3px; letter-spacing: 0.5px; }
 .comm-text { font-size: 14px; color: #fff; line-height: 1.4; }
 .comm-actions { display: flex; gap: 15px; margin-top: 10px; font-size: 11px; color: var(--soft-text); font-weight: bold; }
 .comm-like-btn { cursor: pointer; display: flex; align-items: center; gap: 4px; transition: 0.2s; }
 .comm-like-btn.liked { color: #ff4d4d; }
 .reply-list { margin-left: 45px; margin-top: 12px; border-left: 1px solid rgba(212, 175, 55, 0.2); padding-left: 15px; }
 
 #fullVideoOverlay {
 position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000;
 z-index: 30000; display: none; align-items: center; justify-content: center;
 }
 .close-full-video { position: absolute; top: 20px; right: 20px; color: white; font-size: 30px; cursor: pointer; z-index: 30001; }

 /* Wallet UI */
 #walletUI {
 position: fixed; top: 0; left: 0; width: 100%; height: 100%;
 background: rgba(0,0,0,0.95); z-index: 35000; display: none; flex-direction: column;
 align-items: center; justify-content: center; padding: 20px;
 }
 .wallet-card { background: var(--card); border: 2px solid var(--gold); border-radius: 20px; width: 100%; max-width: 400px; padding: 30px; text-align: center; max-height: 90vh; overflow-y: auto; }
 .package-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 25px; }
 .pkg-btn { background: var(--glass); border: 1px solid var(--border); padding: 15px; border-radius: 12px; cursor: pointer; transition: 0.3s; }
 .pkg-btn:hover { border-color: var(--gold); background: rgba(212, 175, 55, 0.1); }
 .pkg-price { display: block; font-size: 18px; font-weight: 900; color: var(--gold); }
 .pkg-label { font-size: 12px; color: var(--soft-text); }
 
 /* NEW CASH OUT STYLES */
 .cashout-box { background: rgba(46, 204, 113, 0.1); border: 1px solid var(--green); border-radius: 12px; padding: 15px; margin-top: 20px; text-align: left; }
 .withdraw-btn { background: var(--green); color: black; border: none; padding: 12px; border-radius: 8px; width: 100%; font-weight: bold; margin-top: 10px; cursor: pointer; }

 /* ACTIVITY LOG STYLES */
 .activity-log { margin-top: 30px; text-align: left; border-top: 1px solid var(--border); padding-top: 20px; }
 .log-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
 .log-info { display: flex; flex-direction: column; }
 .log-type { font-size: 13px; font-weight: bold; color: var(--text); }
 .log-time { font-size: 10px; color: var(--soft-text); }
 .log-amt { font-weight: 900; font-size: 14px; }
 .amt-pos { color: var(--green); }
 .amt-neg { color: var(--red); }

 /* ADMIN PANEL STYLES */
 #adminUI {
 position: fixed; top: 0; left: 0; width: 100%; height: 100%;
 background: #000; z-index: 45000; display: none; flex-direction: column; padding: 20px; overflow-y: auto;
 }
 .admin-req-card { background: var(--card); border: 1px solid var(--gold); padding: 15px; border-radius: 12px; margin-bottom: 10px; display: flex; flex-direction: column; gap: 8px; }
 .admin-tool-box { background: var(--card); border: 1px solid #333; padding: 15px; border-radius: 12px; margin-bottom: 20px; }
 .admin-user-item { display: flex; align-items: center; justify-content: space-between; padding: 10px; border-bottom: 1px solid #222; }

 /* Rules & Info UI */
 #infoUI {
 position: fixed; top: 0; left: 0; width: 100%; height: 100%;
 background: radial-gradient(circle at top, #1A1C1E, #000);
 z-index: 40000; display: none; flex-direction: column; padding: 20px; overflow-y: auto;
 }
 .info-content { max-width: 600px; margin: 40px auto; line-height: 1.6; }
 .info-section { background: var(--card); border: 1px solid var(--border); border-radius: 15px; padding: 20px; margin-bottom: 20px; border-left: 4px solid var(--gold); }
 .info-title { color: var(--gold); font-weight: 900; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
 @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
 
 .discover-search {
 width: 100%; background: var(--glass); border: 1px solid var(--border);
 padding: 15px; border-radius: 12px; color: white; margin-bottom: 25px; outline: none;
 font-size: 16px; backdrop-filter: blur(10px);
 }
 .discover-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
 .user-card {
 background: var(--card); border: 1px solid var(--border); border-radius: 18px;
 padding: 15px; text-align: center; position: relative; transition: 0.3s;
 overflow: hidden; cursor: pointer;
 }
 .user-card:active { transform: scale(0.95); border-color: var(--gold); }
 .user-card::before {
 content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
 background: conic-gradient(transparent, var(--gold), transparent 30%);
 animation: rotateBorder 4s linear infinite; opacity: 0.3; z-index: 0;
 }
 @keyframes rotateBorder { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
 .card-inner { position: relative; z-index: 1; background: var(--card); border-radius: 15px; }
 .discover-ava { width: 70px; height: 70px; border-radius: 50%; border: 2px solid var(--gold); margin-bottom: 10px; object-fit: cover; }
 .discover-name { font-weight: bold; font-size: 14px; margin-bottom: 5px; color: white; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
 .discover-status { font-size: 11px; color: var(--gold); font-weight: 900; text-transform: uppercase; letter-spacing: 1px; }
 .req-badge { position: absolute; top: -5px; right: -5px; background: red; color: white; font-size: 10px; padding: 2px 5px; border-radius: 50%; display: none; }

 /* VISITORS UI STYLES */
 #visitorsUI {
 position: fixed; top: 0; left: 0; width: 100%; height: 100%;
 background: #000; z-index: 30000; display: none; flex-direction: column;
 padding: 20px; animation: fadeIn 0.3s ease;
 }
 .visitor-row {
 display: flex; align-items: center; justify-content: space-between;
 padding: 12px 15px; background: var(--card); border-radius: 15px;
 border: 1px solid var(--border); margin-bottom: 10px;
 }
 .visitor-info { display: flex; align-items: center; gap: 12px; }
 .visitor-ava { width: 45px; height: 45px; border-radius: 50%; border: 1px solid var(--gold); object-fit: cover; }

 /* EDIT PROFILE & INFO UI STYLES */
 #editProfileUI {
 position: fixed; top: 0; left: 0; width: 100%; height: 100%;
 background: #000; z-index: 40000; display: none; flex-direction: column;
 padding: 20px; overflow-y: auto;
 }
 .edit-label { display: block; color: var(--gold); font-size: 12px; font-weight: 900; margin: 15px 0 5px 5px; text-transform: uppercase; }
 
 #userDetailedInfoUI {
 position: fixed; bottom: 0; left: 0; width: 100%; height: 75%;
 background: rgba(15, 15, 15, 0.98); backdrop-filter: blur(25px);
 z-index: 30000; display: none; flex-direction: column;
 border-top: 2px solid var(--gold); border-radius: 30px 30px 0 0;
 animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
 padding: 30px 20px;
 }
 .info-row { display: flex; align-items: center; gap: 20px; padding: 15px; background: var(--glass); border-radius: 12px; margin-bottom: 10px; }
 .info-row i { color: var(--gold); font-size: 20px; width: 25px; text-align: center; }
 .info-val-label { font-size: 11px; color: var(--soft-text); display: block; }
 .info-val-text { font-size: 16px; color: #fff; font-weight: bold; }

 /* PRIVATE ACCOUNT MESSAGE - REFINED */
 .private-lock-screen {
 display: flex; align-items: center; justify-content: center;
 padding: 60px 20px; text-align: center; color: var(--soft-text);
 flex: 1; height: 100%;
 }
 .private-lock-screen p {
 font-size: 10px;
 text-transform: uppercase;
 letter-spacing: 2px;
 font-weight: bold;
 opacity: 0.6;
 border-top: 1px solid var(--border);
 border-bottom: 1px solid var(--border);
 padding: 8px 15px;
 }

 #settingsUI {
 position: fixed; top: 0; left: 0; width: 100%; height: 100%;
 background: #000; z-index: 40000; display: none; flex-direction: column;
 padding: 20px;
 }
 .settings-option {
 display: flex; align-items: center; justify-content: space-between;
 padding: 20px; background: var(--card); border-radius: 15px;
 margin-bottom: 12px; border: 1px solid var(--border);
 }
 .settings-option input[type="radio"] { accent-color: var(--gold); transform: scale(1.5); }

 /* NEW TYPING & PUSH UI */
 .typing-indicator {
 display: none; align-items: center; gap: 5px; padding: 8px 15px;
 background: var(--card); border-radius: 15px; width: fit-content;
 margin-top: 5px; font-size: 12px; color: var(--soft-text);
 }
 .typing-dot {
 width: 4px; height: 4px; background: var(--gold); border-radius: 50%;
 animation: typingAnim 1.4s infinite;
 }
 .typing-dot:nth-child(2) { animation-delay: 0.2s; }
 .typing-dot:nth-child(3) { animation-delay: 0.4s; }
 @keyframes typingAnim { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

 .global-push-notif {
 position: fixed; top: -100px; left: 50%; transform: translateX(-50%);
 width: 90%; max-width: 350px; background: var(--card);
 border: 1px solid var(--gold); border-radius: 12px; padding: 12px;
 z-index: 99999; display: flex; align-items: center; gap: 12px;
 transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
 box-shadow: 0 10px 30px rgba(0,0,0,0.5);
 }
 .global-push-notif.show { top: 20px; }

 /* FOLLOWERS/FOLLOWING UI */
 #socialListsUI {
 position: fixed; top: 0; left: 0; width: 100%; height: 100%;
 background: #000; z-index: 30000; display: none; flex-direction: column;
 padding-top: 20px; animation: fadeIn 0.3s ease;
 }
 .social-list-header {
 display: flex; align-items: center; justify-content: space-between;
 padding: 15px 20px; border-bottom: 1px solid var(--border);
 }
 .social-search-box {
 padding: 10px 20px;
 }
 .social-search-input {
 width: 100%; background: #1a1a1a; border: 1px solid #333;
 padding: 10px 15px; border-radius: 10px; color: white; outline: none;
 font-size: 14px;
 }
 .social-item {
 display: flex; align-items: center; justify-content: space-between;
 padding: 12px 20px; border-bottom: 1px solid rgba(255,255,255,0.02);
 transition: 0.2s;
 }
 .social-item:active { background: rgba(255,255,255,0.05); }
 .social-user-info { display: flex; align-items: center; gap: 12px; flex: 1; }
 .social-ava { width: 50px; height: 50px; border-radius: 50%; border: 1.5px solid var(--gold); object-fit: cover; }
 .social-name { font-weight: bold; font-size: 14px; color: white; }
 .social-status { font-size: 11px; color: var(--gold); text-transform: uppercase; letter-spacing: 0.5px; margin-top: 2px; }
 .social-actions-btns { display: flex; align-items: center; gap: 10px; }
 .social-msg-btn { 
 background: transparent; border: 1px solid var(--gold); color: var(--gold);
 width: 35px; height: 35px; border-radius: 50%; display: flex;
 align-items: center; justify-content: center; cursor: pointer;
 transition: 0.3s;
 }
 .social-msg-btn:hover { background: var(--gold); color: black; }

 
 
 
 
 
 
 .navbar {
 position: fixed !important; 
 top: 0 !important; 
 left: 0 !important; 
 width: 100% !important; 
 height: 56px !important;
 background: transparent !important; /* áƒ¡áƒáƒ”áƒ áƒ—áƒáƒ“ áƒáƒ áƒáƒœáƒáƒ˜áƒ áƒ˜ áƒ¤áƒ”áƒ áƒ˜ */
 backdrop-filter: none !important; /* áƒ›áƒáƒ•áƒáƒ¨áƒáƒ áƒ”áƒ— áƒ“áƒáƒ‘áƒ£áƒ áƒ•áƒ */
 -webkit-backdrop-filter: none !important;
 border-bottom: none !important; /* áƒ›áƒáƒ•áƒáƒ¨áƒáƒ áƒ”áƒ— áƒ®áƒáƒ–áƒ˜áƒª */
 box-shadow: none !important;
 display: flex !important; 
 align-items: center !important; 
 justify-content: space-between !important;
 padding: 0 15px !important; 
 z-index: 10000 !important;
}
 #main-feed {
 height: 100vh !important; /* áƒ›áƒ—áƒ”áƒšáƒ˜ áƒ”áƒ™áƒ áƒáƒœáƒ˜ */
 width: 100vw !important; 
 overflow-y: scroll !important;
 scroll-snap-type: y mandatory !important; 
 scrollbar-width: none !important; 
 padding-top: 0 !important; /* áƒáƒ áƒáƒœáƒáƒ˜áƒ áƒ˜ áƒ“áƒáƒ¨áƒáƒ áƒ”áƒ‘áƒ áƒ–áƒ”áƒ›áƒáƒ“áƒáƒœ */
 margin-top: 0 !important;
 scroll-padding-top: 0 !important;
}
 .video-card {
 height: 100vh !important; 
 width: 100% !important; 
 scroll-snap-align: start !important; /* áƒ§áƒáƒ•áƒ”áƒšáƒ—áƒ•áƒ˜áƒ¡ áƒ–áƒ”áƒ“áƒ áƒ™áƒ˜áƒ“áƒ”áƒ–áƒ” áƒ’áƒáƒ¡áƒ¬áƒáƒ áƒ“áƒ”áƒ¡ */
 scroll-snap-stop: always !important; 
 position: relative !important; 
 background: #000 !important;
}
// áƒáƒ› áƒáƒœáƒ˜áƒ›áƒáƒªáƒ˜áƒáƒ¡ CSS-áƒ¨áƒ˜ áƒ©áƒáƒáƒ›áƒáƒ¢áƒ”áƒ‘, áƒ áƒáƒ› "LIVE" áƒ¬áƒ áƒ” áƒáƒªáƒ˜áƒ›áƒªáƒ˜áƒ›áƒ“áƒ”áƒ¡
const style = document.createElement('style');
style.innerHTML = `
@keyframes pulse-live {
    0% { border-color: #ff4d4d; box-shadow: 0 0 0 0 rgba(255, 77, 77, 0.4); }
    70% { border-color: #ff0000; box-shadow: 0 0 0 10px rgba(255, 77, 77, 0); }
    100% { border-color: #ff4d4d; box-shadow: 0 0 0 0 rgba(255, 77, 77, 0); }
}`;
document.head.appendChild(style);
 </style>
</head>




<div id="liveFloatingBtn" onclick="openActiveLivesModal()" style="display:none; position:fixed; right:20px; top:100px; z-index:9999; cursor:pointer; text-align:center;">
    <div style="width:60px; height:60px; border-radius:50%; border:3px solid #ff4d4d; padding:2px; background:#000; box-shadow: 0 0 15px rgba(255,77,77,0.5); animation: pulse-live 1.5s infinite;">
        <img id="lastLiveAva" src="" style="width:100%; height:100%; border-radius:50%; object-fit:cover;">
    </div>
    <div style="background:#ff4d4d; color:white; font-size:10px; font-weight:900; padding:2px 8px; border-radius:10px; margin-top:-10px; position:relative; border:2px solid #000;">LIVE</div>
</div>

<div id="activeLivesModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); backdrop-filter:blur(10px); z-index:100000; align-items:center; justify-content:center;">
    <div style="background:#1a1a1a; width:85%; max-width:400px; border-radius:20px; border:1px solid var(--gold); padding:20px;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <b style="color:var(--gold); letter-spacing:1px;">áƒáƒ¥áƒ¢áƒ˜áƒ£áƒ áƒ˜ áƒšáƒáƒ˜áƒ•áƒ”áƒ‘áƒ˜</b>
            <i class="fas fa-times" onclick="closeActiveLivesModal()" style="color:gray; cursor:pointer; font-size:20px;"></i>
        </div>
        <div id="modalLivesList" style="display:flex; flex-direction:column; gap:15px; max-height:400px; overflow-y:auto;">
            </div>
    </div>
</div>
<audio id="ringtone" src="https://emigrantbook.com/ringtone.mp3" loop preload="auto"></audio>
<body>
 <audio id="msgSound" src="https://emigrantbook.com/messenger_notification.mp3" preload="auto"></audio>
 <audio id="typingSound" src="https://emigrantbook.com/messenger_typing.mp3" preload="auto"></audio>

 <div id="globalPush" class="global-push-notif">
 <img id="pushAva" src="" style="width:40px; height:40px; border-radius:50%; border:1px solid var(--gold);">
 <div>
 <b id="pushName" style="color:var(--gold); font-size:13px; display:block;"></b>
 <span id="pushTxt" style="font-size:12px; color:white;"></span>
 </div>
 </div>

 <div id="onboardingUI" class="auth-overlay" style="display: none; z-index: 60000; background: rgba(0,0,0,0.95);">
 <div class="auth-card" style="max-width: 450px; border: 1px solid var(--gold);">
 <div id="obSlide1" class="ob-step">
 <h1 class="glowing-token" style="font-size: 40px;" data-key="welcome">WELCOME</h1>
 <h2 style="color:var(--gold); margin-bottom:15px;">IMPACT-áƒáƒ áƒ¥áƒ˜áƒ¢áƒ”áƒ¥áƒ¢áƒáƒ áƒ˜</h2>
 <p style="color:var(--text); font-size:14px; line-height:1.6;" data-key="ob_desc1">áƒ¨áƒ”áƒœ áƒ›áƒáƒ®áƒ•áƒ“áƒ˜ áƒ¡áƒ˜áƒ•áƒ áƒªáƒ”áƒ¨áƒ˜, áƒ¡áƒáƒ“áƒáƒª áƒ§áƒáƒ•áƒ”áƒšáƒ˜ áƒ˜áƒ“áƒ”áƒ áƒ¨áƒ”áƒ“áƒ”áƒ’áƒáƒ“ áƒ’áƒáƒ áƒ“áƒáƒ˜áƒ¥áƒ›áƒœáƒ”áƒ‘áƒ. áƒ©áƒ•áƒ”áƒœáƒ˜ áƒáƒšáƒáƒ¢áƒ¤áƒáƒ áƒ›áƒ áƒ”áƒ¤áƒ£áƒ«áƒœáƒ”áƒ‘áƒ áƒ áƒ”áƒáƒšáƒ£áƒ  áƒ’áƒáƒ•áƒšáƒ”áƒœáƒáƒ¡ (Impact).</p>
 <button class="profile-btn btn-gold" style="width:100%; margin-top:20px;" onclick="nextObSlide(2)" data-key="next">áƒ¨áƒ”áƒ›áƒ“áƒ”áƒ’áƒ˜</button>
 </div>
 <div id="obSlide2" class="ob-step" style="display:none;">
 <h2 style="color:var(--gold); margin-bottom:15px;">AKHO TOKEN</h2>
 <p style="color:var(--text); font-size:14px; line-height:1.6;" data-key="ob_desc2">áƒ”áƒ¡ áƒáƒ  áƒáƒ áƒ˜áƒ¡ áƒ£áƒ‘áƒ áƒáƒšáƒáƒ“ áƒªáƒ˜áƒ¤áƒ áƒ£áƒšáƒ˜ áƒáƒ¥áƒ¢áƒ˜áƒ•áƒ˜. áƒ¢áƒáƒ™áƒ”áƒœáƒ˜ áƒ¨áƒ”áƒœáƒ˜ áƒ¨áƒ áƒáƒ›áƒ˜áƒ¡ áƒ“áƒ áƒ’áƒáƒ•áƒšáƒ”áƒœáƒ˜áƒ¡ áƒ¡áƒáƒ–áƒáƒ›áƒ˜áƒ. áƒ¨áƒ”áƒ¥áƒ›áƒ”áƒœáƒ˜ áƒ¦áƒ˜áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ™áƒáƒœáƒ¢áƒ”áƒœáƒ¢áƒ˜ áƒ“áƒ áƒ“áƒáƒáƒ’áƒ áƒáƒ•áƒ” áƒ›áƒ®áƒáƒ áƒ“áƒáƒ­áƒ”áƒ áƒ.</p>
 <button class="profile-btn btn-gold" style="width:100%; margin-top:20px;" onclick="nextObSlide(3)" data-key="got_it">áƒ’áƒáƒ•áƒ˜áƒ’áƒ” áƒ¬áƒ”áƒ¡áƒ”áƒ‘áƒ˜</button>
 </div>
 <div id="obSlide3" class="ob-step" style="display:none;">
 <h2 style="color:var(--gold); margin-bottom:15px;" data-key="agreement">ğŸ“œ áƒ©áƒ•áƒ”áƒœáƒ˜ áƒ¨áƒ”áƒ—áƒáƒœáƒ®áƒ›áƒ”áƒ‘áƒ</h2>
 <div id="tokenSuccessAnim" style="display:none; margin-bottom: 15px;">
 <div class="glowing-token" style="font-size: 50px;">ğŸ’</div>
 <p style="color:var(--gold); font-weight:bold;">IMPACT ACTIVATED</p>
 </div>
 <ul id="rulesList" style="text-align: left; color: var(--soft-text); font-size: 13px; list-style: none; padding: 0;">
 <li style="margin-bottom:8px;"><i class="fas fa-check" style="color:var(--gold);"></i> <span data-key="rule1">áƒ˜áƒ§áƒáƒ•áƒ˜ áƒ’áƒáƒ›áƒ­áƒ•áƒ˜áƒ áƒ•áƒáƒšáƒ” áƒ“áƒ áƒ áƒ”áƒáƒšáƒ£áƒ áƒ˜</span></li>
 <li style="margin-bottom:8px;"><i class="fas fa-check" style="color:var(--gold);"></i> <span data-key="rule2">áƒáƒšáƒáƒ¢áƒ¤áƒáƒ áƒ›áƒáƒ–áƒ” áƒ¥áƒ›áƒ”áƒ“áƒ”áƒ‘áƒ áƒ¤áƒáƒ¡áƒ“áƒ”áƒ‘áƒ</span></li>
 <li style="margin-bottom:8px;"><i class="fas fa-check" style="color:var(--gold);"></i> <span data-key="rule3">áƒ§áƒáƒ•áƒ”áƒšáƒ˜ IMPACT áƒáƒ˜áƒ¡áƒáƒ®áƒ”áƒ‘áƒ áƒ‘áƒáƒšáƒáƒœáƒ¡áƒ–áƒ”</span></li>
 </ul>
 <button class="profile-btn btn-gold" id="finishBtn" style="width:100%; margin-top:20px;" onclick="runSuccessAndFinish()" data-key="ready">áƒ›áƒ–áƒáƒ“ áƒ•áƒáƒ  áƒ¨áƒ”áƒ“áƒ”áƒ’áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡!</button>
 </div>
 </div>
 </div>

 <div id="authUI" class="auth-overlay">
 <img src="https://emigrantbook.com/1000084015-removebg-preview.png" class="auth-logo-img" alt="Tk Logo">
 <h1 class="glowing-token">TOKEN</h1>
 <div id="loginBox" class="auth-card">
 <input type="email" id="uEmail" class="auth-input" placeholder="Email / áƒ”áƒšáƒ¤áƒáƒ¡áƒ¢áƒ">
 <input type="password" id="uPass" class="auth-input" placeholder="Password / áƒáƒáƒ áƒáƒšáƒ˜">
 <button style="width:100%; padding:14px; background:var(--gold); border:none; border-radius:8px; font-weight:bold; cursor:pointer;" onclick="handleAuth('login')" data-key="login">áƒ¨áƒ”áƒ¡áƒ•áƒšáƒ</button>
 <p onclick="toggleAuthBox('reg')" style="color:var(--gold); text-align:center; margin-top:20px; cursor:pointer; font-size:14px;" data-key="create_account">áƒáƒœáƒ’áƒáƒ áƒ˜áƒ¨áƒ˜áƒ¡ áƒ¨áƒ”áƒ¥áƒ›áƒœáƒ</p>
 </div>
 <div id="regBox" class="auth-card" style="display:none;">
 <input type="text" id="rFirstName" class="auth-input" placeholder="First Name / áƒ¡áƒáƒ®áƒ”áƒšáƒ˜">
 <input type="text" id="rLastName" class="auth-input" placeholder="Last Name / áƒ’áƒ•áƒáƒ áƒ˜">
 <input type="email" id="rEmail" class="auth-input" placeholder="Email / áƒ”áƒšáƒ¤áƒáƒ¡áƒ¢áƒ">
 <input type="password" id="rPass" class="auth-input" placeholder="Password / áƒáƒáƒ áƒáƒšáƒ˜">
 <button style="width:100%; padding:14px; background:var(--gold); border:none; border-radius:8px; font-weight:bold; cursor:pointer;" onclick="handleAuth('reg')" data-key="register">áƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒ</button>
 <p onclick="toggleAuthBox('login')" style="color:var(--gold); text-align:center; margin-top:20px; cursor:pointer;" data-key="have_account">áƒ£áƒ™áƒ•áƒ” áƒ’áƒáƒ¥áƒ•áƒ— áƒáƒœáƒ’áƒáƒ áƒ˜áƒ¨áƒ˜?</p>
 </div>
 </div>

 <nav class="navbar">
 <div style="display: flex; align-items: center;">
 <a href="/" style="display: flex; align-items: center; text-decoration: none;">
 <img src="https://emigrantbook.com/1000084015-removebg-preview.png" style="height: 44px; width: auto;" alt="Tk">
 </a>
 </div>
 <div style="display: flex; align-items: center; gap: 15px;">
 <div style="position: relative;">
 <i class="fas fa-user-plus" style="color: var(--gold); font-size: 20px; cursor: pointer;" onclick="openRequestsUI()"></i>
 <span id="reqCount" class="req-badge">0</span>
 </div>
 
 <div onclick="openCommunityWall()" style="background: var(--gold); color: #000; padding: 5px 12px; border-radius: 8px; font-weight: 900; font-size: 12px; cursor: pointer; text-transform: uppercase; margin-right: 5px;">
 áƒáƒáƒ¡áƒ¢áƒ˜
</div>
 
 <div style="background:rgba(0,0,0,0.3); border:1px solid var(--gold); padding:5px 14px; border-radius:50px; cursor:pointer;" onclick="openWalletUI()">
 <span id="userAkho" style="color:var(--gold); font-weight:bold;">0.00</span>
 <small style="color:var(--gold); font-size:10px; font-weight:900;">AKHO</small>
 </div>
 </div>
 </nav>

 <div id="walletUI">
 <div class="wallet-card">
 <div id="walletMain">
 <h2 style="color:var(--gold); font-weight:900;">AKHO WALLET</h2>
 <p style="font-size:14px; color:var(--soft-text); margin-top:10px;" data-key="wallet_desc">áƒ¨áƒ”áƒáƒ•áƒ¡áƒ”áƒ— áƒ‘áƒáƒšáƒáƒœáƒ¡áƒ˜ Stripe áƒ’áƒáƒ“áƒáƒ®áƒ“áƒ˜áƒ—</p>
 <p onclick="openInfoUI()" style="font-size:11px; color:var(--gold); cursor:pointer; margin-top:5px; text-decoration:underline;" data-key="how_it_works">áƒ áƒáƒ’áƒáƒ  áƒ›áƒ£áƒ¨áƒáƒáƒ‘áƒ¡ AKHO?</p>
 <div class="package-grid">
 <div class="pkg-btn" onclick="initStripePayment('https://buy.stripe.com/test_28EdR90bE4TWbyCbPBcbC01')">
 <span class="pkg-price">â‚¬1.00</span>
 <span class="pkg-label">10 AKHO</span>
 </div>
 <div class="pkg-btn" onclick="initStripePayment('https://buy.stripe.com/test_14AcN56A25Y0fOS6vhcbC02')">
 <span class="pkg-price">â‚¬5.00</span>
 <span class="pkg-label">55 AKHO</span>
 </div>
 <div class="pkg-btn" onclick="initStripePayment('https://buy.stripe.com/test_dRm5kDaQi1HK326bPBcbC03')">
 <span class="pkg-price">â‚¬10.00</span>
 <span class="pkg-label">120 AKHO</span>
 </div>
 <div class="pkg-btn" onclick="initStripePayment('https://buy.stripe.com/test_5kQ3cve2u1HK5ae3j5cbC04')">
 <span class="pkg-price">â‚¬50.00</span>
 <span class="pkg-label">700 AKHO</span>
 </div>
 </div>

 <div class="cashout-box">
 <b style="color:var(--gold); font-size: 13px;" data-key="cash_out">áƒ—áƒáƒœáƒ®áƒ˜áƒ¡ áƒ’áƒáƒ¢áƒáƒœáƒ</b>
 <p style="font-size: 11px; color: var(--soft-text); margin-top: 5px;" data-key="min_withdraw">áƒ›áƒ˜áƒœáƒ˜áƒ›áƒáƒšáƒ£áƒ áƒ˜ áƒ’áƒáƒ¢áƒáƒœáƒ: 50.00 â‚¬ (500 AKHO)</p>
 <div id="cashoutForm" style="display:none; margin-top: 10px;">
 <input type="text" id="ibanInput" class="auth-input" placeholder="IBAN / PayPal" style="margin-bottom:5px; padding:10px;">
 <button class="withdraw-btn" onclick="submitWithdraw()" data-key="withdraw_req">áƒ’áƒáƒ¢áƒáƒœáƒ˜áƒ¡ áƒ›áƒáƒ—áƒ®áƒáƒ•áƒœáƒ</button>
 </div>
 <div id="cashoutStatus" style="color:var(--red); font-size: 11px; margin-top: 10px; font-weight: bold;"></div>
 </div>

 <div class="activity-log">
 <b style="color:var(--gold); font-size:14px;">áƒáƒ¥áƒ¢áƒ˜áƒ•áƒáƒ‘áƒ˜áƒ¡ áƒ˜áƒ¡áƒ¢áƒáƒ áƒ˜áƒ</b>
 <div id="logContent" style="margin-top:10px;"></div>
 </div>

 <button style="margin-top:25px; background:none; border:none; color:gray; cursor:pointer;" onclick="document.getElementById('walletUI').style.display='none'" data-key="close">áƒ“áƒáƒ®áƒ£áƒ áƒ•áƒ</button>
 </div>
 <div id="paymentPending" style="display:none; animation: fadeIn 0.5s;">
 <i class="fas fa-spinner fa-spin" style="font-size: 40px; color: var(--gold);"></i>
 <h2 style="color:var(--gold); margin-top:15px;" data-key="thanks">áƒ›áƒáƒ“áƒšáƒáƒ‘áƒ!</h2>
 <p style="color:white; margin:15px 0;" data-key="payment_msg">áƒ’áƒáƒ“áƒáƒ®áƒ“áƒ áƒ›áƒ˜áƒ¦áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ. AKHO áƒ—áƒ¥áƒ•áƒ”áƒœáƒ¡ áƒ‘áƒáƒšáƒáƒœáƒ¡áƒ–áƒ” áƒáƒ˜áƒ¡áƒáƒ®áƒ”áƒ‘áƒ 5-10 áƒ¬áƒ£áƒ—áƒ¨áƒ˜ áƒ’áƒáƒ“áƒáƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒ˜áƒ¡ áƒ¨áƒ”áƒ›áƒ“áƒ”áƒ’.</p>
 <button class="profile-btn btn-gold" onclick="location.reload()" data-key="check_balance">áƒ‘áƒáƒšáƒáƒœáƒ¡áƒ˜áƒ¡ áƒ’áƒáƒ“áƒáƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒ</button>
 </div>
 </div>
 </div>

 <div id="adminUI">
 <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
 <h2 style="color:var(--gold); font-weight:900;">ADMIN PANEL</h2>
 <span onclick="document.getElementById('adminUI').style.display='none'" style="cursor:pointer; font-size:24px; color:gray;">âœ•</span>
 </div>
 
 <div class="admin-tool-box">
 <b style="color:var(--gold);">áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒáƒ áƒ—áƒ•áƒ</b>
 <input type="text" id="admSearch" class="auth-input" placeholder="áƒ¡áƒáƒ®áƒ”áƒšáƒ˜áƒ— áƒ«áƒ”áƒ‘áƒœáƒ..." oninput="adminSearchUsers(this.value)" style="margin-top:10px;">
 <div id="admUserList" style="max-height: 200px; overflow-y: auto; background: #111; border-radius: 8px;"></div>
 </div>

 <div id="admUserActions" style="display:none;" class="admin-tool-box">
 <h4 id="admTargetName" style="color:white; margin-bottom:10px;"></h4>
 <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
 <button class="withdraw-btn" style="background:var(--gold); color:black;" onclick="adminAction('addAkho')">AKHO áƒ“áƒáƒ áƒ˜áƒªáƒ®áƒ•áƒ</button>
 <button class="withdraw-btn" style="background:var(--red); color:white;" onclick="adminAction('resetAkho')">AKHO áƒ’áƒáƒœáƒ£áƒšáƒ”áƒ‘áƒ</button>
 <button class="withdraw-btn" onclick="adminAction('warning')">áƒ’áƒáƒ¤áƒ áƒ—áƒ®áƒ˜áƒšáƒ”áƒ‘áƒ</button>
 <button class="withdraw-btn" style="background:var(--red);" onclick="adminAction('ban')">áƒ“áƒáƒ‘áƒšáƒáƒ™áƒ•áƒ</button>
 <button class="withdraw-btn" style="background:var(--green); color:black;" onclick="adminAction('unban')">áƒ‘áƒšáƒáƒ™áƒ˜áƒ¡ áƒ›áƒáƒ®áƒ¡áƒœáƒ</button>
 <button class="withdraw-btn" style="background:gray;" onclick="adminAction('delete')">áƒ¬áƒáƒ¨áƒšáƒ</button>
 </div>
 </div>

 <h3 style="color:var(--gold); margin: 15px 0 10px 0;">áƒ’áƒáƒ¢áƒáƒœáƒ˜áƒ¡ áƒ›áƒáƒ—áƒ®áƒáƒ•áƒœáƒ”áƒ‘áƒ˜</h3>
 <div id="adminReqList" style="flex:1; overflow-y:auto;"></div>
 </div>

 <div id="infoUI">
 <div style="display:flex; justify-content:space-between; align-items:center;">
 <h2 style="color:var(--gold); font-weight:900;" data-key="rules_title">áƒ¬áƒ”áƒ¡áƒ”áƒ‘áƒ˜ áƒ“áƒ áƒ’áƒáƒœáƒ›áƒáƒ áƒ¢áƒ”áƒ‘áƒ</h2>
 <span onclick="document.getElementById('infoUI').style.display='none'" style="cursor:pointer; font-size:24px;">âœ•</span>
 </div>
 <div class="info-content">
 <div class="info-section">
 <div class="info-title"><i class="fas fa-coins"></i> <span data-key="what_is_akho">áƒ áƒ áƒáƒ áƒ˜áƒ¡ AKHO?</span></div>
 <p data-key="akho_desc">AKHO áƒáƒ áƒ˜áƒ¡ áƒáƒšáƒáƒ¢áƒ¤áƒáƒ áƒ›áƒ˜áƒ¡ áƒ¨áƒ˜áƒ“áƒ áƒáƒ¥áƒ¢áƒ˜áƒ•áƒ˜. áƒ›áƒ˜áƒ¡áƒ˜ áƒ¡áƒáƒ¨áƒ£áƒáƒšáƒ”áƒ‘áƒ˜áƒ— áƒ—áƒ¥áƒ•áƒ”áƒœ áƒ¨áƒ”áƒ’áƒ˜áƒ«áƒšáƒ˜áƒáƒ— áƒ’áƒáƒ›áƒáƒ®áƒáƒ¢áƒáƒ— áƒ›áƒ®áƒáƒ áƒ“áƒáƒ­áƒ”áƒ áƒ áƒ“áƒ áƒ“áƒáƒáƒ¯áƒ˜áƒšáƒ“áƒáƒáƒ— áƒ¡áƒáƒ˜áƒœáƒ¢áƒ”áƒ áƒ”áƒ¡áƒ áƒ™áƒáƒœáƒ¢áƒ”áƒœáƒ¢áƒ˜. 1 áƒ”áƒ•áƒ áƒ = 10 AKHO.</p>
 </div>
 <div class="info-section">
 <div class="info-title"><i class="fas fa-money-bill-wave"></i> <span data-key="make_money">áƒ áƒáƒ’áƒáƒ  áƒ•áƒ˜áƒ¨áƒáƒ•áƒáƒ— áƒ¤áƒ£áƒšáƒ˜?</span></div>
 <p data-key="make_money_desc">áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ”áƒ— TOKEN (áƒ•áƒ˜áƒ“áƒ”áƒ). áƒ áƒáƒªáƒ áƒ•áƒ˜áƒœáƒ›áƒ” áƒ—áƒ¥áƒ•áƒ”áƒœáƒ¡ áƒ•áƒ˜áƒ“áƒ”áƒáƒ¡ "áƒ“áƒáƒáƒšáƒáƒ˜áƒ¥áƒ”áƒ‘áƒ¡", áƒ—áƒ¥áƒ•áƒ”áƒœáƒ¡ áƒ‘áƒáƒšáƒáƒœáƒ¡áƒ–áƒ” áƒáƒ•áƒ¢áƒáƒ›áƒáƒ¢áƒ£áƒ áƒáƒ“ áƒ“áƒáƒ˜áƒ áƒ˜áƒªáƒ®áƒ”áƒ‘áƒ <b>2.00 AKHO</b>.</p>
 </div>
 <div class="info-section">
 <div class="info-title"><i class="fas fa-shopping-cart"></i> <span data-key="top_up">áƒ‘áƒáƒšáƒáƒœáƒ¡áƒ˜áƒ¡ áƒ¨áƒ”áƒ•áƒ¡áƒ”áƒ‘áƒ</span></div>
 <p data-key="top_up_desc">áƒ’áƒáƒ“áƒáƒ®áƒ“áƒ áƒ®áƒ“áƒ”áƒ‘áƒ Stripe-áƒ˜áƒ—. áƒ¢áƒ áƒáƒœáƒ–áƒáƒ¥áƒªáƒ˜áƒ˜áƒ¡ áƒ“áƒáƒ¡áƒ áƒ£áƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ¨áƒ”áƒ›áƒ“áƒ”áƒ’, AKHO áƒáƒ˜áƒ¡áƒáƒ®áƒ”áƒ‘áƒ 5-10 áƒ¬áƒ£áƒ—áƒ¨áƒ˜ áƒ’áƒáƒ“áƒáƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒ˜áƒ¡ áƒ¨áƒ”áƒ›áƒ“áƒ”áƒ’.</p>
 </div>
 <div class="info-section">
 <div class="info-title"><i class="fas fa-gavel"></i> <span data-key="fees">áƒ¢áƒáƒ áƒ˜áƒ¤áƒ”áƒ‘áƒ˜ áƒ“áƒ áƒ¬áƒ”áƒ¡áƒ”áƒ‘áƒ˜</span></div>
 <p data-key="fees_list">â€¢ áƒšáƒáƒ˜áƒ¥áƒ˜: -0.1 AKHO<br>â€¢ áƒ™áƒáƒ›áƒ”áƒœáƒ¢áƒáƒ áƒ˜: -0.5 AKHO<br>â€¢ áƒ’áƒáƒ›áƒáƒ¬áƒ”áƒ áƒ: -1.00 AKHO<br>â€¢ áƒ¨áƒ”áƒ¢áƒ§áƒáƒ‘áƒ˜áƒœáƒ”áƒ‘áƒ: -0.2 AKHO</p>
 <small style="color:gray;" data-key="fees_footer">áƒ§áƒáƒ•áƒ”áƒšáƒ˜ áƒ¥áƒ›áƒ”áƒ“áƒ”áƒ‘áƒ áƒ¦áƒ˜áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ, áƒ áƒáƒ“áƒ’áƒáƒœ áƒ˜áƒ¡ áƒáƒ˜áƒ áƒ“áƒáƒáƒ˜áƒ  áƒáƒ¯áƒ˜áƒšáƒ“áƒáƒ”áƒ‘áƒ¡ áƒáƒ•áƒ¢áƒáƒ áƒ¡.</small>
 </div>
 </div>
 </div>

 <div id="commentsUI">
 <div style="padding:18px; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid rgba(212, 175, 55, 0.2);">
 <b style="color:var(--gold); font-size:16px; letter-spacing:1px;" data-key="comments">áƒ™áƒáƒ›áƒ”áƒœáƒ¢áƒáƒ áƒ”áƒ‘áƒ˜</b>
 <span onclick="document.getElementById('commentsUI').style.display='none'" style="cursor:pointer; color:gray; font-size:22px;">âœ•</span>
 </div>
 <div id="commList" style="flex:1; overflow-y:auto; padding:10px 0;"></div>
 <div style="padding:15px; background:rgba(25, 25, 25, 0.9); display:flex; gap:12px; border-top:1px solid rgba(212, 175, 55, 0.2); align-items:center;">
 <input type="text" id="commInp" class="chat-input" placeholder="..." style="margin-bottom:0; background:#000; border:1px solid #444;">
 <button class="chat-send-btn" onclick="postComment()" style="width:45px; height:45px;"><i class="fas fa-paper-plane"></i></button>
 </div>
 </div>

 <div id="requestsUI">
 <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
 <h2 style="color:var(--gold); font-weight:900;" data-key="notifications">áƒ¨áƒ”áƒ¢áƒ§áƒáƒ‘áƒ˜áƒœáƒ”áƒ‘áƒ”áƒ‘áƒ˜</h2>
 <span onclick="document.getElementById('requestsUI').style.display='none'" style="cursor:pointer; font-size:24px;">âœ•</span>
 </div>
 <div id="reqList"></div>
 </div>

 <div id="discoveryUI">
 <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
 <h2 style="color:var(--gold); font-weight:900;" data-key="discover">áƒáƒ¦áƒ›áƒáƒáƒ©áƒ˜áƒœáƒ”</h2>
 <span onclick="closeDiscovery()" style="cursor:pointer; font-size:20px; color:gray;">âœ•</span>
 </div>
 <input type="text" class="discover-search" placeholder="..." oninput="searchUsers(this.value)" id="searchPlaceholder">
 <div id="discoverGrid" class="discover-grid"></div>
 </div>

 <div id="visitorsUI">
 <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px;">
 <h2 style="color:var(--gold); font-weight:900; font-size: 20px;" data-key="profile_views">áƒáƒ áƒáƒ¤áƒ˜áƒšáƒ˜áƒ¡ áƒœáƒáƒ®áƒ•áƒ”áƒ‘áƒ˜</h2>
 <span onclick="document.getElementById('visitorsUI').style.display='none'" style="cursor:pointer; font-size:26px; color:gray;">âœ•</span>
 </div>
 <div id="visitorsList" style="flex:1; overflow-y:auto;"></div>
 </div>

 <div id="editProfileUI">
 <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
 <h2 style="color:var(--gold); font-weight:900;" data-key="edit">áƒ áƒ”áƒ“áƒáƒ¥áƒ¢áƒ˜áƒ áƒ”áƒ‘áƒ</h2>
 <span onclick="document.getElementById('editProfileUI').style.display='none'" style="cursor:pointer; font-size:26px; color:gray;">âœ•</span>
 </div>
 <label class="edit-label" data-key="full_name">áƒ¡áƒ áƒ£áƒšáƒ˜ áƒ¡áƒáƒ®áƒ”áƒšáƒ˜</label>
 <input type="text" id="editName" class="auth-input">
 <label class="edit-label" data-key="location">áƒ¡áƒáƒªáƒ®áƒáƒ•áƒ áƒ”áƒ‘áƒ”áƒšáƒ˜ áƒáƒ“áƒ’áƒ˜áƒšáƒ˜</label>
 <input type="text" id="editCity" class="auth-input" placeholder="...">
 <label class="edit-label" data-key="age">áƒáƒ¡áƒáƒ™áƒ˜</label>
 <input type="number" id="editAge" class="auth-input">
 <label class="edit-label" data-key="relation">áƒ£áƒ áƒ—áƒ˜áƒ”áƒ áƒ—áƒáƒ‘áƒ</label>
 <select id="editRelation" class="auth-input" style="background:#2a2a2a; color:white; border:1px solid #444;">
 <option value="Single" data-key="single">áƒ“áƒáƒ£áƒáƒ¯áƒáƒ®áƒ”áƒ‘áƒ”áƒšáƒ˜</option>
 <option value="Married" data-key="married">áƒ“áƒáƒáƒ¯áƒáƒ®áƒ”áƒ‘áƒ£áƒšáƒ˜</option>
 <option value="In Relationship" data-key="in_rel">áƒ£áƒ áƒ—áƒ˜áƒ”áƒ áƒ—áƒáƒ‘áƒáƒ¨áƒ˜</option>
 </select>
 <label class="edit-label" data-key="phone">áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜áƒ¡ áƒœáƒáƒ›áƒ”áƒ áƒ˜</label>
 <input type="tel" id="editPhone" class="auth-input">
 <button class="profile-btn btn-gold" style="width:100%; margin-top:30px; padding:15px;" onclick="saveProfileChanges()" data-key="save">áƒªáƒ•áƒšáƒ˜áƒšáƒ”áƒ‘áƒ”áƒ‘áƒ˜áƒ¡ áƒ¨áƒ”áƒœáƒáƒ®áƒ•áƒ</button>
 </div>

 <div id="userDetailedInfoUI">
 <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
 <h2 style="color:var(--gold); font-weight:900;" data-key="info">áƒ˜áƒœáƒ¤áƒáƒ áƒ›áƒáƒªáƒ˜áƒ</h2>
 <span onclick="document.getElementById('userDetailedInfoUI').style.display='none'" style="cursor:pointer; font-size:26px; color:gray;">âœ•</span>
 </div>
 <div id="infoContent"></div>
 </div>

 <div id="settingsUI">
 <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
 <h2 style="color:var(--gold); font-weight:900;" data-key="profile_manage">áƒáƒ áƒáƒ¤áƒ˜áƒšáƒ˜áƒ¡ áƒ›áƒáƒ áƒ—áƒ•áƒ</h2>
 <span onclick="document.getElementById('settingsUI').style.display='none'" style="cursor:pointer; font-size:26px; color:gray;">âœ•</span>
 </div>
 
 <div class="settings-option">
 <div>
 <b style="display:block;" data-key="public">áƒ¡áƒáƒ¯áƒáƒ áƒ (Public)</b>
 <small style="color:gray;" data-key="public_desc">áƒœáƒ”áƒ‘áƒ˜áƒ¡áƒ›áƒ˜áƒ”áƒ  áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ¡ áƒ¨áƒ”áƒ£áƒ«áƒšáƒ˜áƒ áƒœáƒáƒ®áƒáƒ¡ áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒáƒ áƒáƒ¤áƒ˜áƒšáƒ˜</small>
 </div>
 <input type="radio" name="pPrivacy" value="public" id="privPublic" onchange="updatePrivacy('public')">
 </div>

 <div class="settings-option">
 <div>
 <b style="display:block;" data-key="friends">áƒ›áƒ”áƒ’áƒáƒ‘áƒ áƒ”áƒ‘áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡ (Friends)</b>
 <small style="color:gray;" data-key="friends_desc">áƒ—áƒ¥áƒ•áƒ”áƒœáƒ¡ áƒáƒ áƒáƒ¤áƒ˜áƒšáƒ¡ áƒœáƒáƒ®áƒáƒ•áƒ”áƒœ áƒ›áƒ®áƒáƒšáƒáƒ“ áƒ˜áƒ¡áƒ˜áƒœáƒ˜, áƒ•áƒ˜áƒœáƒª áƒ’áƒáƒ›áƒáƒ¬áƒ”áƒ áƒ˜áƒšáƒ˜ áƒ’áƒ§áƒáƒ•áƒ—</small>
 </div>
 <input type="radio" name="pPrivacy" value="friends" id="privFriends" onchange="updatePrivacy('friends')">
 </div>

 <div class="settings-option">
 <div>
 <b style="display:block;" data-key="private">áƒáƒ áƒ˜áƒ•áƒáƒ¢áƒ£áƒšáƒ˜ (Private)</b>
 <small style="color:gray;" data-key="private_desc">áƒ—áƒ¥áƒ•áƒ”áƒœáƒ¡ áƒáƒ áƒáƒ¤áƒ˜áƒšáƒ¡ áƒœáƒáƒ®áƒáƒ•áƒ— áƒ›áƒ®áƒáƒšáƒáƒ“ áƒ—áƒ¥áƒ•áƒ”áƒœ</small>
 </div>
 <input type="radio" name="pPrivacy" value="private" id="privPrivate" onchange="updatePrivacy('private')">
 </div>

 <button class="profile-btn btn-gold" style="width:100%; margin-top:20px;" onclick="document.getElementById('settingsUI').style.display='none'" data-key="finish">áƒ“áƒáƒ¡áƒ áƒ£áƒšáƒ”áƒ‘áƒ</button>
 </div>

 <div id="profileUI">
 <div class="profile-nav">
 <i class="fas fa-home" style="color: var(--soft-text); font-size: 22px; cursor: pointer;" onclick="document.getElementById('profileUI').style.display='none'; refreshHomeFeed();"></i>
 
 <div style="display: flex; align-items: center; gap: 15px;">
 <i id="feetStats" class="fas fa-shoe-prints" style="color: var(--gold); font-size: 18px; cursor: pointer; display:none;" onclick="showProfileVisitors()"></i>
 <i class="fas fa-times" style="color: var(--gold); font-size: 22px; cursor: pointer;" onclick="document.getElementById('profileUI').style.display='none'; refreshHomeFeed();"></i>
 <div class="menu-trigger" onclick="toggleSideMenu(true)">
 <span></span><span></span><span></span><span></span>
 </div>
 </div>
 </div>
 
 <div class="profile-header">
 <div class="profile-ava-wrapper">
 <img id="profAva" src="" class="profile-ava-main">
 <div id="profStatusDot" class="status-dot">
 <span id="profLastSeenText" class="last-seen-tag"></span>
 </div>
 </div>
 <h2 id="profName" style="color:white; margin-top:10px;">Name</h2>
 <div class="profile-stats-row">
 <div class="stat-box">
 <span id="statVidsCount" class="stat-num">0</span>
 <span class="stat-label" data-key="videos">áƒ•áƒ˜áƒ“áƒ”áƒ</span>
 </div>
 <div class="stat-box" id="followersStatBtn">
 <span id="statFollowersCount" class="stat-num">0</span>
 <span class="stat-label" data-key="followers">áƒ’áƒáƒ›áƒáƒ›áƒ¬áƒ”áƒ áƒ˜</span>
 </div>
 <div class="stat-box" id="followingStatBtn">
 <span id="statFollowingCount" class="stat-num">0</span>
 <span class="stat-label" data-key="following">áƒ’áƒáƒ›áƒáƒ¬áƒ”áƒ áƒ</span>
 </div>
 </div>
 <div id="profControls" style="margin-top:15px;"></div>
 <div id="profTabs" class="profile-nav-menu">
 <button class="p-nav-btn active" id="infoBtn" data-key="info">áƒ˜áƒœáƒ¤áƒáƒ áƒ›áƒáƒªáƒ˜áƒ</button>
 <button class="p-nav-btn" data-key="photos">áƒ¤áƒáƒ¢áƒáƒ”áƒ‘áƒ˜</button>
 <button class="p-nav-btn">Reels</button>
 </div>
 <div id="profGrid" class="video-grid"></div>
 </div>
 </div>

 <div id="sideMenuOverlay" class="side-menu-overlay" onclick="toggleSideMenu(false)"></div>
 <div id="sideMenu" class="side-menu">
 <div style="display:flex; justify-content:flex-end; margin-bottom:20px;">
 <i class="fas fa-times" style="font-size:24px; color:var(--gold); cursor:pointer;" onclick="toggleSideMenu(false)"></i>
 </div>

 <a href="#" class="menu-item" onclick="toggleLanguage()">
 <i class="fas fa-globe"></i> 
 <span id="langSwitchBtn">Language: EN / áƒ”áƒœáƒ: áƒ¥áƒáƒ </span>
 </a>

 <a href="#" class="menu-item" onclick="startLiveFunc()">
 <div class="live-btn-custom">
 <div class="live-status-dot"></div>
 <span data-key="live">áƒšáƒáƒ˜áƒ•áƒ˜</span>
 </div>
 </a>
 <a href="#" class="menu-item">
 <i class="fas fa-euro-sign"></i> 
 <span><span data-key="real_balance">áƒ áƒ”áƒáƒšáƒ£áƒ áƒ˜ áƒ‘áƒáƒšáƒáƒœáƒ¡áƒ˜</span>: <b id="realCash">0.00</b> â‚¬</span>
 </a>

 <a href="#" id="adminMenuBtn" class="menu-item" style="display:none;" onclick="openAdminUI()">
 <i class="fas fa-user-shield" style="color:var(--red);"></i> áƒáƒ“áƒ›áƒ˜áƒœ áƒáƒáƒœáƒ”áƒšáƒ˜
 </a>

 <a href="#" class="menu-item" onclick="openEditor()"><i class="fas fa-edit"></i> <span data-key="editor">áƒ áƒ”áƒ“áƒáƒ¥áƒ¢áƒáƒ áƒ˜</span></a>
 <a href="#" class="menu-item" onclick="openSettings()"><i class="fas fa-cog"></i> <span data-key="profile_manage">áƒáƒ áƒáƒ¤áƒ˜áƒšáƒ˜áƒ¡ áƒ›áƒáƒ áƒ—áƒ•áƒ</span></a>
 <a href="#" class="menu-item" onclick="openWalletUI(); toggleSideMenu(false);"><i class="fas fa-wallet"></i> <span data-key="balance">áƒ‘áƒáƒšáƒáƒœáƒ¡áƒ˜</span></a>
 <a href="#" class="menu-item" onclick="openInfoUI(); toggleSideMenu(false);"><i class="fas fa-info-circle"></i> <span data-key="info">áƒ˜áƒœáƒ¤áƒáƒ áƒ›áƒáƒªáƒ˜áƒ</span></a>
 <div style="flex:1;"></div>
 <a href="#" class="menu-item" onclick="logoutUser()" style="border-top: 1px solid rgba(255,255,255,0.05); color: #ff4d4d;">
 <i class="fas fa-sign-out-alt" style="color: #ff4d4d;"></i> <span data-key="logout">áƒ’áƒáƒ¡áƒ•áƒšáƒ</span>
 </a>
 </div>

 <div id="messengerUI" style="display: none;">
 <div style="padding:15px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center;">
 <h2 style="color:var(--gold); font-weight:900;" data-key="chats">áƒ©áƒáƒ¢áƒ”áƒ‘áƒ˜</h2>
 <span onclick="document.getElementById('messengerUI').style.display='none'; refreshHomeFeed();" style="cursor:pointer; font-size:24px; color:gray;">âœ•</span>
 </div>
 <div id="chatList" style="flex:1; overflow-y:auto;"></div>
</div>

<div id="individualChat" style="display: none;">
 <div class="chat-header">
 <div style="display:flex; align-items:center; gap:12px;">
 <i class="fas fa-arrow-left" onclick="closeChat()" style="cursor:pointer;"></i>
 <img id="chatTargetAva" src="" style="width:40px; height:40px; border-radius:50%; border:1px solid var(--gold);">
 <b id="chatTargetName" style="color:white; font-size:15px;">Name</b>
 </div>
 <div style="display:flex; gap:18px; align-items:center;">
 <i class="fas fa-video" onclick="startVideoCall()" style="cursor:pointer; color:var(--gold); font-size:18px;"></i>
 <i class="fas fa-times" onclick="closeChat()" style="cursor:pointer; font-size:20px; color:var(--soft-text);"></i>
 </div>
 </div>
 
 <div id="chatMessages" class="chat-messages"></div>
 
 <div id="typingIndicator" class="typing-indicator" style="display:none; margin-left: 15px; margin-bottom: 5px;">
 <div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>
 </div>

 <div class="chat-input-area" style="padding: 10px; display:flex; align-items:center; gap:10px; background: rgba(0,0,0,0.5);">
 <i class="fas fa-plus-circle" style="color:var(--gold); font-size:20px; cursor:pointer;"></i>
 <input type="text" id="messageInp" class="chat-input" placeholder="áƒ¨áƒ”áƒ¢áƒ§áƒáƒ‘áƒ˜áƒœáƒ”áƒ‘áƒ..." oninput="handleTyping()" style="margin-bottom:0; border-radius: 20px;">
 
 <div id="voiceBtn" onclick="toggleVoiceRecord()" style="cursor:pointer; width:35px; height:35px; display:flex; align-items:center; justify-content:center; color:var(--gold);">
 <i class="fas fa-microphone" id="micIcon"></i>
 </div>
 
 <button class="chat-send-btn" onclick="sendMessage()" style="width:35px; height:35px; background:var(--gold); border-radius:50%; color:black; border:none;">
 <i class="fas fa-paper-plane" style="font-size:14px;"></i>
 </button>
 </div>
</div>

 <div id="fullVideoOverlay">
 <span class="close-full-video" onclick="closeFullVideo()">âœ•</span>
 <video id="fullVideoTag" controls autoplay loop style="width:100%; height:100%; object-fit:contain;"></video>
 </div>

 <div id="uploadModal">
 <div style="background: var(--card); padding: 25px; border-radius: 15px; width: 100%; max-width: 400px; border: 1px solid var(--gold);">
 <h3 style="color:var(--gold); margin-bottom:15px;" data-key="upload_token">TOKEN-áƒ–áƒ” áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ</h3>
 <input type="file" id="videoInput" accept="video/*" style="margin-bottom:15px; color:white; width:100%;">
 <textarea id="videoDesc" placeholder="..." style="width:100%; padding:12px; background:#121212; border:1px solid #333; color:white; margin-bottom:15px; border-radius:8px; height:80px; resize:none;"></textarea>
 <button id="upBtn" onclick="startTokenUpload()" style="width:100%; padding:12px; background:var(--gold); border:none; border-radius:8px; font-weight:bold; color:black;" data-key="upload">áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ</button>
 <button onclick="document.getElementById('uploadModal').style.display='none'" style="width:100%; background:none; border:none; color:gray; margin-top:10px; cursor:pointer;" data-key="cancel">áƒ’áƒáƒ£áƒ¥áƒ›áƒ”áƒ‘áƒ</button>
 </div>
 </div>




 <div id="main-feed"></div>

 <div id="socialListsUI" style="display:none;">
 <div class="social-list-header">
 <i class="fas fa-chevron-left" style="color:var(--gold); font-size:20px; cursor:pointer;" onclick="document.getElementById('socialListsUI').style.display='none'"></i>
 <b id="socialListTitle" style="color:white; font-size:18px;">áƒ¡áƒ˜áƒ</b>
 <div style="width:20px;"></div>
 </div>
 <div class="social-search-box">
 <input type="text" class="social-search-input" id="socialQuickSearch" placeholder="áƒ›áƒáƒ«áƒ”áƒ‘áƒœáƒ” áƒ¡áƒáƒ®áƒ”áƒšáƒ˜áƒ—..." oninput="filterSocialList(this.value)">
 </div>
 <div id="socialContentArea" style="flex:1; overflow-y:auto; padding-bottom:20px;"></div>
 </div>

 <div class="mobile-bottom-nav">
 <a href="/" class="m-nav-item active" onclick="event.preventDefault(); refreshHomeFeed();"><i class="fas fa-home"></i><span data-key="home">áƒ›áƒ—áƒáƒ•áƒáƒ áƒ˜</span></a>
 <a onclick="openDiscovery()" class="m-nav-item"><i class="fas fa-users"></i><span data-key="people">áƒ®áƒáƒšáƒ®áƒ˜</span></a>
 <div class="m-nav-item" onclick="document.getElementById('uploadModal').style.display='flex'">
 <div class="token-plus-btn"><i class="fas fa-plus" style="color: #000; font-size: 20px;"></i></div>
 <span style="color: var(--gold); font-weight: bold; margin-top: 5px;">TOKEN</span>
 </div>
 <a onclick="openMessenger()" class="m-nav-item"><i class="fas fa-envelope"></i><span data-key="chat">áƒ©áƒáƒ¢áƒ˜</span></a>
 <div class="m-nav-item" onclick="openProfile(auth.currentUser.uid)">
 <img id="bottomNavAva" src="https://ui-avatars.com/api/?name=U" class="m-nav-ava">
 <span data-key="profile">áƒáƒ áƒáƒ¤áƒ˜áƒšáƒ˜</span>
 <input type="file" id="avaInp" hidden accept="image/*" onchange="uploadNewAva(this)">
 </div>
 </div>




<div id="liveUI" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:99999; flex-direction:column;">
    <div id="live-video-container" style="width:100%; height:100%; background:#111; position:relative;">
        <div id="remote-live-video" style="width:100%; height:100%;"></div>
        
        <div style="position:absolute; top:20px; left:15px; display:flex; align-items:center; gap:10px; background:rgba(0,0,0,0.5); padding:5px 12px; border-radius:30px; border:1px solid rgba(212,175,55,0.3);">
            <img id="liveHostAva" src="" style="width:32px; height:32px; border-radius:50%; border:1px solid var(--gold);">
            <div>
                <b id="liveHostName" style="color:white; font-size:12px; display:block;">Host Name</b>
                <small id="liveViewerCount" style="color:var(--gold); font-size:10px;"><i class="fas fa-eye"></i> 0</small>
            </div>
            <button id="followHostBtn" style="background:var(--gold); border:none; border-radius:15px; padding:4px 10px; font-size:11px; font-weight:bold; margin-left:5px;">Follow</button>
        </div>

        <div style="position:absolute; right:15px; bottom:150px; display:flex; flex-direction:column; gap:20px; align-items:center;">
            <div class="live-action" onclick="sendLiveHeart()"><i class="fas fa-heart" style="color:#ff4d4d; font-size:28px;"></i></div>
            
            <div class="live-action" onclick="toggleGiftPanel()"><i class="fas fa-gift" style="color:var(--gold); font-size:28px;"></i></div>
            
            <div class="live-action" onclick="shareLive()"><i class="fas fa-share" style="color:white; font-size:28px;"></i></div>
            <div class="live-action" onclick="endLive()"><i class="fas fa-times-circle" style="color:#aaa; font-size:28px;"></i></div>
        </div>

        <div id="giftPanel" style="display:none; position:absolute; bottom:0; left:0; width:100%; background:rgba(0,0,0,0.95); border-top:2px solid var(--gold); padding:20px; border-radius:20px 20px 0 0; z-index:100000; box-shadow: 0 -10px 30px rgba(0,0,0,0.5);">
            <div style="display:flex; justify-content:space-between; margin-bottom:20px; align-items:center;">
                <b style="color:var(--gold); font-size:16px; letter-spacing:1px;">áƒ’áƒáƒ£áƒ’áƒ–áƒáƒ•áƒœáƒ” áƒ¡áƒáƒ©áƒ£áƒ¥áƒáƒ áƒ˜</b>
                <i class="fas fa-times" onclick="toggleGiftPanel()" style="color:gray; cursor:pointer; font-size:20px;"></i>
            </div>
            <div style="display:grid; grid-template-columns: repeat(4, 1fr); gap:15px; text-align:center;">
                <div class="gift-item" onclick="sendGift('ğŸŒ¹', 1, 'Rose')" style="cursor:pointer; background:rgba(255,255,255,0.05); padding:10px; border-radius:12px;">
                    <div style="font-size:32px; margin-bottom:5px;">ğŸŒ¹</div>
                    <small style="color:var(--gold); font-weight:bold; display:block;">1</small>
                </div>
                <div class="gift-item" onclick="sendGift('ğŸ’', 10, 'Diamond')" style="cursor:pointer; background:rgba(255,255,255,0.05); padding:10px; border-radius:12px;">
                    <div style="font-size:32px; margin-bottom:5px;">ğŸ’</div>
                    <small style="color:var(--gold); font-weight:bold; display:block;">10</small>
                </div>
                <div class="gift-item" onclick="sendGift('ğŸ¦', 50, 'Lion')" style="cursor:pointer; background:rgba(255,255,255,0.05); padding:10px; border-radius:12px;">
                    <div style="font-size:32px; margin-bottom:5px;">ğŸ¦</div>
                    <small style="color:var(--gold); font-weight:bold; display:block;">50</small>
                </div>
                <div class="gift-item" onclick="sendGift('ğŸ‘‘', 100, 'Crown')" style="cursor:pointer; background:rgba(255,255,255,0.05); padding:10px; border-radius:12px;">
                    <div style="font-size:32px; margin-bottom:5px;">ğŸ‘‘</div>
                    <small style="color:var(--gold); font-weight:bold; display:block;">100</small>
                </div>
            </div>
        </div>

        <div id="liveChatBox" style="position:absolute; bottom:80px; left:15px; width:70%; max-height:200px; overflow-y:auto; display:flex; flex-direction:column; gap:5px; pointer-events:none;"></div>
        
        <div style="position:absolute; bottom:20px; left:0; width:100%; padding:0 15px; display:flex; gap:10px;">
            <input type="text" id="liveMsgInp" style="flex:1; background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.2); border-radius:20px; padding:10px 15px; color:white; outline:none;" placeholder="áƒ—áƒ¥áƒ•áƒ˜ áƒ áƒáƒ›áƒ”...">
            <button onclick="sendLiveComment()" style="background:var(--gold); border:none; width:40px; height:40px; border-radius:50%; color:black;"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>
</div>

 
 <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
 <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
 <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
 
 
 <script>
 const firebaseConfig = { 
 apiKey: "AIzaSyDA1MD_juyLU26Nytxn7kzEcBkpVhS3rbk", 
 authDomain: "emigrantbook.firebaseapp.com", 
 databaseURL: "https://emigrantbook-default-rtdb.europe-west1.firebasedatabase.app", 
 projectId: "emigrantbook", 
 appId: "1:138873748174:web:2d4422cdd62cd7e594ee9f" 
 };
 firebase.initializeApp(firebaseConfig);
 const db = firebase.database(), auth = firebase.auth();

const client = AgoraRTC.createClient({ mode: "rtc", codec: "vp8" });
 // --- LANGUAGE LOGIC ---
 const translations = {
 ka: {
 welcome: "áƒ›áƒáƒ’áƒ”áƒ¡áƒáƒšáƒ›áƒ”áƒ‘áƒ˜áƒ—", ob_desc1: "áƒ¨áƒ”áƒœ áƒ›áƒáƒ®áƒ•áƒ“áƒ˜ áƒ¡áƒ˜áƒ•áƒ áƒªáƒ”áƒ¨áƒ˜, áƒ¡áƒáƒ“áƒáƒª áƒ§áƒáƒ•áƒ”áƒšáƒ˜ áƒ˜áƒ“áƒ”áƒ áƒ¨áƒ”áƒ“áƒ”áƒ’áƒáƒ“ áƒ’áƒáƒ áƒ“áƒáƒ˜áƒ¥áƒ›áƒœáƒ”áƒ‘áƒ...", next: "áƒ¨áƒ”áƒ›áƒ“áƒ”áƒ’áƒ˜",
 ob_desc2: "áƒ”áƒ¡ áƒáƒ  áƒáƒ áƒ˜áƒ¡ áƒ£áƒ‘áƒ áƒáƒšáƒáƒ“ áƒªáƒ˜áƒ¤áƒ áƒ£áƒšáƒ˜ áƒáƒ¥áƒ¢áƒ˜áƒ•áƒ˜...", got_it: "áƒ’áƒáƒ•áƒ˜áƒ’áƒ” áƒ¬áƒ”áƒ¡áƒ”áƒ‘áƒ˜", agreement: "ğŸ“œ áƒ©áƒ•áƒ”áƒœáƒ˜ áƒ¨áƒ”áƒ—áƒáƒœáƒ®áƒ›áƒ”áƒ‘áƒ",
 rule1: "áƒ˜áƒ§áƒáƒ•áƒ˜ áƒ’áƒáƒ›áƒ­áƒ•áƒ˜áƒ áƒ•áƒáƒšáƒ” áƒ“áƒ áƒ áƒ”áƒáƒšáƒ£áƒ áƒ˜", rule2: "áƒáƒšáƒáƒ¢áƒ¤áƒáƒ áƒ›áƒáƒ–áƒ” áƒ¥áƒ›áƒ”áƒ“áƒ”áƒ‘áƒ áƒ¤áƒáƒ¡áƒ“áƒ”áƒ‘áƒ", rule3: "áƒ§áƒáƒ•áƒ”áƒšáƒ˜ IMPACT áƒáƒ˜áƒ¡áƒáƒ®áƒ”áƒ‘áƒ áƒ‘áƒáƒšáƒáƒœáƒ¡áƒ–áƒ”",
 ready: "áƒ›áƒ–áƒáƒ“ áƒ•áƒáƒ  áƒ¨áƒ”áƒ“áƒ”áƒ’áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡!", login: "áƒ¨áƒ”áƒ¡áƒ•áƒšáƒ", create_account: "áƒáƒœáƒ’áƒáƒ áƒ˜áƒ¨áƒ˜áƒ¡ áƒ¨áƒ”áƒ¥áƒ›áƒœáƒ", register: "áƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒ",
 have_account: "áƒ£áƒ™áƒ•áƒ” áƒ’áƒáƒ¥áƒ•áƒ— áƒáƒœáƒ’áƒáƒ áƒ˜áƒ¨áƒ˜?", wallet_desc: "áƒ¨áƒ”áƒáƒ•áƒ¡áƒ”áƒ— áƒ‘áƒáƒšáƒáƒœáƒ¡áƒ˜ Stripe áƒ’áƒáƒ“áƒáƒ®áƒ“áƒ˜áƒ—", how_it_works: "áƒ áƒáƒ’áƒáƒ  áƒ›áƒ£áƒ¨áƒáƒáƒ‘áƒ¡ AKHO?",
 cash_out: "áƒ—áƒáƒœáƒ®áƒ˜áƒ¡ áƒ’áƒáƒ¢áƒáƒœáƒ", min_withdraw: "áƒ›áƒ˜áƒœáƒ˜áƒ›áƒáƒšáƒ£áƒ áƒ˜ áƒ’áƒáƒ¢áƒáƒœáƒ: 50.00 â‚¬ (500 AKHO)", withdraw_req: "áƒ’áƒáƒ¢áƒáƒœáƒ˜áƒ¡ áƒ›áƒáƒ—áƒ®áƒáƒ•áƒœáƒ",
 close: "áƒ“áƒáƒ®áƒ£áƒ áƒ•áƒ", thanks: "áƒ›áƒáƒ“áƒšáƒáƒ‘áƒ!", payment_msg: "áƒ’áƒáƒ“áƒáƒ®áƒ“áƒ áƒ›áƒ˜áƒ¦áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ. AKHO áƒáƒ˜áƒ¡áƒáƒ®áƒ”áƒ‘áƒ 5-10 áƒ¬áƒ£áƒ—áƒ¨áƒ˜", check_balance: "áƒ‘áƒáƒšáƒáƒœáƒ¡áƒ˜áƒ¡ áƒ’áƒáƒ“áƒáƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒ",
 rules_title: "áƒ¬áƒ”áƒ¡áƒ”áƒ‘áƒ˜ áƒ“áƒ áƒ’áƒáƒœáƒ›áƒáƒ áƒ¢áƒ”áƒ‘áƒ", what_is_akho: "áƒ áƒ áƒáƒ áƒ˜áƒ¡ AKHO?", akho_desc: "AKHO áƒáƒ áƒ˜áƒ¡ áƒáƒšáƒáƒ¢áƒ¤áƒáƒ áƒ›áƒ˜áƒ¡ áƒ¨áƒ˜áƒ“áƒ áƒáƒ¥áƒ¢áƒ˜áƒ•áƒ˜...",
 make_money: "áƒ áƒáƒ’áƒáƒ  áƒ•áƒ˜áƒ¨áƒáƒ•áƒáƒ— áƒ¤áƒ£áƒšáƒ˜?", make_money_desc: "áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ”áƒ— TOKEN (áƒ•áƒ˜áƒ“áƒ”áƒ)...", top_up: "áƒ‘áƒáƒšáƒáƒœáƒ¡áƒ˜áƒ¡ áƒ¨áƒ”áƒ•áƒ¡áƒ”áƒ‘áƒ",
 fees: "áƒ¢áƒáƒ áƒ˜áƒ¤áƒ”áƒ‘áƒ˜ áƒ“áƒ áƒ¬áƒ”áƒ¡áƒ”áƒ‘áƒ˜", fees_list: "â€¢ áƒšáƒáƒ˜áƒ¥áƒ˜: -0.1 AKHO...", comments: "áƒ™áƒáƒ›áƒ”áƒœáƒ¢áƒáƒ áƒ”áƒ‘áƒ˜", notifications: "áƒ¨áƒ”áƒ¢áƒ§áƒáƒ‘áƒ˜áƒœáƒ”áƒ‘áƒ”áƒ‘áƒ˜",
 discover: "áƒáƒ¦áƒ›áƒáƒáƒ©áƒ˜áƒœáƒ”", profile_views: "áƒáƒ áƒáƒ¤áƒ˜áƒšáƒ˜áƒ¡ áƒœáƒáƒ®áƒ•áƒ”áƒ‘áƒ˜", edit: "áƒ áƒ”áƒ“áƒáƒ¥áƒ¢áƒ˜áƒ áƒ”áƒ‘áƒ", full_name: "áƒ¡áƒ áƒ£áƒšáƒ˜ áƒ¡áƒáƒ®áƒ”áƒšáƒ˜",
 location: "áƒ¡áƒáƒªáƒ®áƒáƒ•áƒ áƒ”áƒ‘áƒ”áƒšáƒ˜ áƒáƒ“áƒ’áƒ˜áƒšáƒ˜", age: "áƒáƒ¡áƒáƒ™áƒ˜", relation: "áƒ£áƒ áƒ—áƒ˜áƒ”áƒ áƒ—áƒáƒ‘áƒ", single: "áƒ“áƒáƒ£áƒáƒ¯áƒáƒ®áƒ”áƒ‘áƒ”áƒšáƒ˜", married: "áƒ“áƒáƒáƒ¯áƒáƒ®áƒ”áƒ‘áƒ£áƒšáƒ˜",
 in_rel: "áƒ£áƒ áƒ—áƒ˜áƒ”áƒ áƒ—áƒáƒ‘áƒáƒ¨áƒ˜", phone: "áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜", save: "áƒ¨áƒ”áƒœáƒáƒ®áƒ•áƒ", info: "áƒ˜áƒœáƒ¤áƒáƒ áƒ›áƒáƒªáƒ˜áƒ", profile_manage: "áƒáƒ áƒáƒ¤áƒ˜áƒšáƒ˜áƒ¡ áƒ›áƒáƒ áƒ—áƒ•áƒ",
 public: "áƒ¡áƒáƒ¯áƒáƒ áƒ", friends: "áƒ›áƒ”áƒ’áƒáƒ‘áƒ áƒ”áƒ‘áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡", private: "áƒáƒ áƒ˜áƒ•áƒáƒ¢áƒ£áƒšáƒ˜", finish: "áƒ“áƒáƒ¡áƒ áƒ£áƒšáƒ”áƒ‘áƒ", videos: "áƒ•áƒ˜áƒ“áƒ”áƒ",
 followers: "áƒ’áƒáƒ›áƒáƒ›áƒ¬áƒ”áƒ áƒ˜", following: "áƒ’áƒáƒ›áƒáƒ¬áƒ”áƒ áƒ", photos: "áƒ¤áƒáƒ¢áƒáƒ”áƒ‘áƒ˜", live: "áƒšáƒáƒ˜áƒ•áƒ˜", real_balance: "áƒ áƒ”áƒáƒšáƒ£áƒ áƒ˜ áƒ‘áƒáƒšáƒáƒœáƒ¡áƒ˜",
 editor: "áƒ áƒ”áƒ“áƒáƒ¥áƒ¢áƒáƒ áƒ˜", balance: "áƒ‘áƒáƒšáƒáƒœáƒ¡áƒ˜", logout: "áƒ’áƒáƒ¡áƒ•áƒšáƒ", chats: "áƒ©áƒáƒ¢áƒ”áƒ‘áƒ˜", upload_token: "áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ", upload: "áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ",
 cancel: "áƒ’áƒáƒ£áƒ¥áƒ›áƒ”áƒ‘áƒ", home: "áƒ›áƒ—áƒáƒ•áƒáƒ áƒ˜", people: "áƒ®áƒáƒšáƒ®áƒ˜", chat: "áƒ©áƒáƒ¢áƒ˜", profile: "áƒáƒ áƒáƒ¤áƒ˜áƒšáƒ˜", search_p: "áƒ›áƒáƒ«áƒ”áƒ‘áƒœáƒ” áƒ”áƒ›áƒ˜áƒ’áƒ áƒáƒœáƒ¢áƒ˜...",
 private_profile: "áƒ”áƒ¡ áƒáƒ áƒáƒ¤áƒ˜áƒšáƒ˜ áƒáƒ áƒ˜áƒ•áƒáƒ¢áƒ£áƒšáƒ˜áƒ", follow: "áƒ’áƒáƒ›áƒáƒ¬áƒ”áƒ áƒ", following_btn: "áƒ’áƒáƒ›áƒáƒ¬áƒ”áƒ áƒ˜áƒšáƒ˜áƒ", write: "áƒ›áƒ˜áƒ¬áƒ”áƒ áƒ"
 },
 en: {
 welcome: "WELCOME", ob_desc1: "Welcome to a space where every idea turns into a result. Our platform is based on real Impact.", next: "Next",
 ob_desc2: "This is not just a digital asset. The token is a measure of your work and influence.", got_it: "I understand", agreement: "ğŸ“œ Our Agreement",
 rule1: "Be transparent and real", rule2: "Every action is valued", rule3: "Every IMPACT is reflected on the balance",
 ready: "Ready for Impact!", login: "Login", create_account: "Create Account", register: "Register",
 have_account: "Already have an account?", wallet_desc: "Top up your balance with Stripe", how_it_works: "How AKHO works?",
 cash_out: "Cash Out", min_withdraw: "Minimum withdrawal: 50.00 â‚¬ (500 AKHO)", withdraw_req: "Withdrawal Request",
 close: "Close", thanks: "Thank You!", payment_msg: "Payment received. AKHO will reflect in 5-10 mins.", check_balance: "Check Balance",
 rules_title: "Rules & Info", what_is_akho: "What is AKHO?", akho_desc: "AKHO is the platform's internal asset...",
 make_money: "How to earn money?", make_money_desc: "Upload TOKEN (video). When someone likes it, you get 2.00 AKHO.", top_up: "Top Up",
 fees: "Rates & Rules", fees_list: "â€¢ Like: -0.1 AKHO â€¢ Comment: -0.5 AKHO...", comments: "Comments", notifications: "Notifications",
 discover: "Discover", profile_views: "Profile Views", edit: "Edit Profile", full_name: "Full Name",
 location: "Location", age: "Age", relation: "Relationship", single: "Single", married: "Married",
 in_rel: "In Relationship", phone: "Phone", save: "Save Changes", info: "Information", profile_manage: "Manage Profile",
 public: "Public", friends: "For Friends", private: "Private", finish: "Finish", videos: "Videos",
 followers: "Followers", following: "Following", photos: "Photos", live: "Live", real_balance: "Real Balance",
 editor: "Editor", balance: "Wallet", logout: "Logout", chats: "Chats", upload_token: "Upload Token", upload: "Upload",
 cancel: "Cancel", home: "Home", people: "People", chat: "Chat", profile: "Profile", search_p: "Search emigrant...",
 private_profile: "This profile is private", follow: "Follow", following_btn: "Following", write: "Message"
 }
 };

 let currentLang = localStorage.getItem('appLang') || (navigator.language.startsWith('ka') ? 'ka' : 'en');

 function applyLanguage() {
 document.querySelectorAll('[data-key]').forEach(el => {
 const key = el.getAttribute('data-key');
 if (translations[currentLang][key]) el.innerText = translations[currentLang][key];
 });
 
 // Specific Placeholders
 const searchInp = document.getElementById('searchPlaceholder');
 if(searchInp) searchInp.placeholder = translations[currentLang].search_p;
 
 const commInp = document.getElementById('commInp');
 if(commInp) commInp.placeholder = translations[currentLang].comments + "...";

 const msgInp = document.getElementById('messageInp');
 if(msgInp) msgInp.placeholder = translations[currentLang].chat + "...";
 }

 function toggleLanguage() {
 currentLang = currentLang === 'ka' ? 'en' : 'ka';
 localStorage.setItem('appLang', currentLang);
 applyLanguage();
 toggleSideMenu(false);
 }
 // --- END LANGUAGE LOGIC ---

 let myName = "User";
 let myPhoto = "";
 let myAkho = 0;
 let currentChatId = null;
 let activePostId = null;
 let activeReplyTo = null;
 let currentAdmTarget = null;
 let currentUserData = null;
 let typingTimeout = null;

 // ONLINE STATUS TRACKER
 function updatePresence() {
 const user = auth.currentUser;
 if (!user) return;
 const onlineRef = db.ref(`.info/connected`);
 const userPresenceRef = db.ref(`users/${user.uid}/presence`);
 
 onlineRef.on('value', snap => {
 if (snap.val() === false) return;
 userPresenceRef.onDisconnect().set(firebase.database.ServerValue.TIMESTAMP).then(() => {
 userPresenceRef.set('online');
 });
 });
 }

 function formatTimeShort(timestamp) {
 if (!timestamp || timestamp === 'online') return 'online';
 const now = Date.now();
 const diff = Math.floor((now - timestamp) / 1000);
 if (diff < 60) return "1m";
 if (diff < 3600) return Math.floor(diff / 60) + "m";
 if (diff < 86400) return Math.floor(diff / 3600) + "h";
 return "";
 }

 function stopMainFeedVideos() {
 document.querySelectorAll('#main-feed video').forEach(v => v.pause());
 }

 function refreshHomeFeed() {
 stopMainFeedVideos();
 document.getElementById('discoveryUI').style.display = 'none';
 document.getElementById('profileUI').style.display = 'none';
 document.getElementById('messengerUI').style.display = 'none';
 document.getElementById('settingsUI').style.display = 'none';
 renderTokenFeed();
 }

 function toggleSideMenu(open) {
 const menu = document.getElementById('sideMenu');
 const overlay = document.getElementById('sideMenuOverlay');
 if (open) {
 menu.classList.add('active');
 overlay.style.display = 'block';
 } else {
 menu.classList.remove('active');
 overlay.style.display = 'none';
 }
 }

 

 function nextObSlide(n) {
 document.querySelectorAll('.ob-step').forEach(s => s.style.display = 'none');
 document.getElementById('obSlide' + n).style.display = 'block';
 }
 function runSuccessAndFinish() {
 document.getElementById('rulesList').style.display = 'none';
 document.getElementById('finishBtn').style.display = 'none';
 const animBox = document.getElementById('tokenSuccessAnim');
 animBox.style.display = 'block';
 animBox.classList.add('token-pop');
 setTimeout(() => finishOnboarding(), 1800);
 }
 function finishOnboarding() {
 const user = auth.currentUser;
 if (user) db.ref('users/' + user.uid).update({ hasSeenRules: true });
 document.getElementById('onboardingUI').style.display = 'none';
}

auth.onAuthStateChanged(user => {
 applyLanguage();
 if (user) {
 updatePresence();
 listenToGlobalMessages();
 
 // --- áƒ•áƒ˜áƒ“áƒ”áƒ áƒ–áƒáƒ áƒ˜áƒ¡ áƒ›áƒáƒ¡áƒ›áƒ”áƒœáƒ˜áƒ¡ áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ ---
 db.ref(`video_calls/${user.uid}`).on('value', snap => {
 const call = snap.val();
 if (call && call.status === 'calling') {
 if (confirm(`${call.callerName} áƒ’áƒ˜áƒ áƒ”áƒ™áƒáƒ•áƒ— áƒ•áƒ˜áƒ“áƒ”áƒ áƒ–áƒáƒ áƒ˜áƒ—. áƒ£áƒáƒáƒ¡áƒ£áƒ®áƒ”áƒ‘áƒ—?`)) {
 currentChatId = call.callerUid; 
 startVideoCall(call.channel);
 db.ref(`video_calls/${user.uid}`).update({ status: 'accepted' });
 } else {
 db.ref(`video_calls/${user.uid}`).remove();
 }
 }
 });
 // --------------------------------------

 document.getElementById('authUI').style.display = 'none';
 db.ref('users/' + user.uid).on('value', snap => {
 const d = snap.val();
 if(d) {
 currentUserData = d;
 if(d.isBanned) {
 document.body.innerHTML = '<div style="background:#000; height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center; color:white; font-family:sans-serif; text-align:center; padding:20px;"><i class="fas fa-gavel" style="font-size:80px; color:#ff4d4d; margin-bottom:20px;"></i><h1>Banned / áƒ“áƒáƒ‘áƒšáƒáƒ™áƒ˜áƒšáƒ˜áƒ</h1></div>';
 return;
 }
 myName = d.name || "User";
 myPhoto = d.photo || "https://ui-avatars.com/api/?name=" + myName;
 myAkho = d.akho || 0;
 document.getElementById('userAkho').innerText = myAkho.toFixed(2);
 document.getElementById('realCash').innerText = (myAkho / 10).toFixed(2);
 document.getElementById('bottomNavAva').src = myPhoto;
 if(!d.hasSeenRules) document.getElementById('onboardingUI').style.display = 'flex';
 if(d.role === 'admin') { document.getElementById('adminMenuBtn').style.display = 'flex'; }
 updateCashoutUI();
 loadActivityLog();
 }
 });
 renderTokenFeed();
 loadDiscoveryUsers();
 listenToRequests();
 } else {
 document.getElementById('authUI').style.display = 'flex';
 document.getElementById('main-feed').innerHTML = "";
 }
});

 function updateCashoutUI() {
 const status = document.getElementById('cashoutStatus');
 const form = document.getElementById('cashoutForm');
 if (myAkho >= 500) {
 status.innerText = currentLang === 'ka' ? "áƒ’áƒáƒ¢áƒáƒœáƒ áƒ®áƒ”áƒšáƒ›áƒ˜áƒ¡áƒáƒ¬áƒ•áƒ“áƒáƒ›áƒ˜áƒ!" : "Cashout available!";
 status.style.color = "var(--green)";
 form.style.display = "block";
 } else {
 const diff = 500 - myAkho;
 status.innerText = currentLang === 'ka' ? `áƒ’áƒáƒ™áƒšáƒ˜áƒáƒ— ${(diff/10).toFixed(2)} â‚¬ áƒ’áƒáƒ¢áƒáƒœáƒáƒ›áƒ“áƒ”` : `${(diff/10).toFixed(2)} â‚¬ left until cashout`;
 status.style.color = "var(--red)";
 form.style.display = "none";
 }
 }

 function submitWithdraw() {
 const iban = document.getElementById('ibanInput').value;
 if(!iban || iban.length < 10) return alert("IBAN / PayPal Error");
 
 if(confirm(`Confirm ${(myAkho/10).toFixed(2)} â‚¬?`)) {
 const reqRef = db.ref('withdrawal_requests').push();
 reqRef.set({
 uid: auth.currentUser.uid,
 name: myName,
 amountEur: (myAkho/10).toFixed(2),
 amountAkho: myAkho,
 iban: iban,
 status: 'pending',
 ts: Date.now()
 }).then(() => {
 db.ref(`users/${auth.currentUser.uid}`).update({ akho: 0 });
 addToLog('Cashout Request', -myAkho);
 alert(currentLang === 'ka' ? "áƒ›áƒáƒ—áƒ®áƒáƒ•áƒœáƒ áƒ’áƒáƒ’áƒ–áƒáƒ•áƒœáƒ˜áƒšáƒ˜áƒ!" : "Request sent!");
 document.getElementById('walletUI').style.display = 'none';
 });
 }
 }

 function openAdminUI() {
 toggleSideMenu(false);
 document.getElementById('adminUI').style.display = 'flex';
 loadAdminRequests();
 }

 function adminSearchUsers(q) {
 const list = document.getElementById('admUserList');
 if(!q || q.length < 2) { list.innerHTML = ""; return; }
 db.ref('users').once('value', snap => {
 list.innerHTML = "";
 const data = snap.val();
 Object.entries(data).forEach(([uid, u]) => {
 if(u.name && u.name.toLowerCase().includes(q.toLowerCase())) {
 const div = document.createElement('div');
 div.style = "display:flex; justify-content:space-between; align-items:center; padding:10px; border-bottom:1px solid #222;";
 div.innerHTML = `<span style="color:white; font-size:14px;">${u.name}</span><button class="profile-btn btn-outline" style="padding:5px 10px; font-size:12px;" onclick="selectAdmTarget('${uid}', '${u.name}')">Manage</button>`;
 list.appendChild(div);
 }
 });
 });
 }

 function selectAdmTarget(uid, name) {
 currentAdmTarget = uid;
 document.getElementById('admUserActions').style.display = 'block';
 document.getElementById('admTargetName').innerText = "Manage: " + name;
 }

 function adminAction(type) {
 if(!currentAdmTarget) return;
 if(type === 'warning') {
 const msg = prompt("Warning message:");
 if(msg) db.ref(`notifications/${currentAdmTarget}`).push({ text: "âš ï¸ Admin: " + msg, ts: Date.now(), fromPhoto: "https://emigrantbook.com/1000084015-removebg-preview.png" });
 } else if(type === 'ban') {
 if(confirm("Ban user?")) db.ref(`users/${currentAdmTarget}`).update({ isBanned: true });
 } else if(type === 'unban') {
 if(confirm("Unban user?")) db.ref(`users/${currentAdmTarget}`).update({ isBanned: false });
 } else if(type === 'addAkho') {
 const amt = prompt("AKHO amount:");
 if(amt) db.ref(`users/${currentAdmTarget}/akho`).transaction(c => (c || 0) + parseFloat(amt));
 } else if(type === 'resetAkho') {
 if(confirm("Reset balance?")) db.ref(`users/${currentAdmTarget}`).update({ akho: 0 });
 } else if(type === 'delete') {
 if(confirm("Delete account permanently?")) {
 db.ref(`users/${currentAdmTarget}`).remove();
 document.getElementById('admUserActions').style.display = 'none';
 }
 }
 alert("Done!");
 }

 function loadAdminRequests() {
 const list = document.getElementById('adminReqList');
 db.ref('withdrawal_requests').on('value', snap => {
 list.innerHTML = "";
 const data = snap.val();
 if(!data) { list.innerHTML = "<p style='color:gray;'>No requests</p>"; return; }
 Object.entries(data).forEach(([id, req]) => {
 if(req.status === 'pending') {
 list.innerHTML += `
 <div class="admin-req-card">
 <b>User: ${req.name}</b>
 <span>Amt: ${req.amountEur} â‚¬ (${req.amountAkho} AKHO)</span>
 <span>IBAN: ${req.iban}</span>
 <div style="display:flex; gap:10px;">
 <button class="withdraw-btn" style="background:var(--green);" onclick="approveReq('${id}')">Approve</button>
 <button class="withdraw-btn" style="background:var(--red);" onclick="declineReq('${id}', '${req.uid}', ${req.amountAkho})">Decline</button>
 </div>
 </div>`;
 }
 });
 });
 }

 function approveReq(id) {
 if(confirm("Paid?")) {
 db.ref(`withdrawal_requests/${id}`).update({ status: 'approved' });
 alert("Approved!");
 }
 }

 function declineReq(id, uid, amount) {
 if(confirm("Decline? Coins will return.")) {
 db.ref(`users/${uid}/akho`).transaction(current => (current || 0) + amount);
 db.ref(`withdrawal_requests/${id}`).update({ status: 'declined' });
 alert("Declined.");
 }
 }

 function openWalletUI() {
 document.getElementById('walletUI').style.display = 'flex';
 document.getElementById('walletMain').style.display = 'block';
 document.getElementById('paymentPending').style.display = 'none';
 loadActivityLog();
 }
 function openInfoUI() {
 document.getElementById('infoUI').style.display = 'flex';
 }
 function initStripePayment(url) {
 const user = auth.currentUser;
 if (!user) return alert("Please Login");
 const finalUrl = url + "?client_reference_id=" + user.uid;
 document.getElementById('walletMain').style.display = 'none';
 document.getElementById('paymentPending').style.display = 'block';
 window.open(finalUrl, "_blank");
 }
 function canAfford(cost) {
 if (myAkho >= cost) return true;
 alert(currentLang === 'ka' ? "áƒ¨áƒ”áƒáƒ•áƒ¡áƒ”áƒ— áƒ‘áƒáƒšáƒáƒœáƒ¡áƒ˜!" : "Top up your balance!");
 openWalletUI();
 return false;
 }
 function spendAkho(cost, reason = 'Action') {
 const newBalance = myAkho - cost;
 db.ref(`users/${auth.currentUser.uid}`).update({ akho: newBalance });
 addToLog(reason, -cost);
 }
 function earnAkho(targetUid, amount, reason = 'Impact Reward') {
 db.ref(`users/${targetUid}/akho`).transaction(current => (current || 0) + amount);
 // Log for the receiver
 db.ref(`activity_logs/${targetUid}`).push({
 type: reason,
 amt: amount,
 ts: Date.now()
 });
 }

 function addToLog(type, amt) {
 db.ref(`activity_logs/${auth.currentUser.uid}`).push({
 type: type,
 amt: amt,
 ts: Date.now()
 });
 }

 function loadActivityLog() {
 const box = document.getElementById('logContent');
 db.ref(`activity_logs/${auth.currentUser.uid}`).limitToLast(15).on('value', snap => {
 box.innerHTML = "";
 const data = snap.val();
 if(!data) { box.innerHTML = "<p style='color:gray; font-size:12px;'>áƒ˜áƒ¡áƒ¢áƒáƒ áƒ˜áƒ áƒªáƒáƒ áƒ˜áƒ”áƒšáƒ˜áƒ</p>"; return; }
 Object.values(data).reverse().forEach(log => {
 const isPos = log.amt > 0;
 box.innerHTML += `
 <div class="log-item">
 <div class="log-info">
 <span class="log-type">${log.type}</span>
 <span class="log-time">${new Date(log.ts).toLocaleString()}</span>
 </div>
 <span class="log-amt ${isPos ? 'amt-pos' : 'amt-neg'}">${isPos ? '+' : ''}${log.amt.toFixed(2)}</span>
 </div>`;
 });
 });
 }

 function openComments(postId) {
 activePostId = postId;
 activeReplyTo = null;
 document.getElementById('commentsUI').style.display = 'flex';
 loadComments(postId);
 }
 function loadComments(postId) {
 const list = document.getElementById('commList');
 db.ref(`comments/${postId}`).on('value', snap => {
 list.innerHTML = "";
 const data = snap.val();
 if(!data) return;
 Object.entries(data).forEach(([id, comm]) => {
 const isLiked = comm.likes && comm.likes[auth.currentUser.uid];
 let html = `
 <div class="comment-item">
 <div class="comment-top">
 <img src="${comm.authorPhoto}" class="comm-ava">
 <div class="comm-body">
 <div class="comm-name">${comm.authorName}</div>
 <div class="comm-text">${comm.text}</div>
 <div class="comm-actions">
 <span class="comm-like-btn ${isLiked ? 'liked' : ''}" onclick="likeComment('${id}')">
 <i class="fas fa-heart"></i> ${comm.likes ? Object.keys(comm.likes).length : 0}
 </span>
 <span onclick="prepareReply('${id}', '${comm.authorName}')" style="cursor:pointer;">Reply/áƒáƒáƒ¡áƒ£áƒ®áƒ˜</span>
 </div>
 </div>
 </div>
 <div id="replies-${id}" class="reply-list"></div>
 </div>`;
 list.innerHTML += html;
 if(comm.replies) {
 const rList = document.getElementById(`replies-${id}`);
 Object.values(comm.replies).forEach(r => {
 rList.innerHTML += `
 <div style="display:flex; gap:10px; margin-bottom:10px;">
 <img src="${r.authorPhoto}" style="width:28px; height:28px; border-radius:50%; border:1px solid var(--gold); object-fit:cover;">
 <div>
 <div style="font-size:11px; color:var(--gold); font-weight:900;">${r.authorName}</div>
 <div style="font-size:13px; color:white;">${r.text}</div>
 </div>
 </div>`;
 });
 }
 });
 });
 }
 function prepareReply(commId, name) {
 activeReplyTo = commId;
 document.getElementById('commInp').focus();
 }
 function postComment() {
 if (!canAfford(0.5)) return;
 const text = document.getElementById('commInp').value;
 if(!text.trim() || !activePostId) return;
 if(activeReplyTo) {
 db.ref(`comments/${activePostId}/${activeReplyTo}/replies`).push({
 authorId: auth.currentUser.uid, authorName: myName, authorPhoto: myPhoto, text: text, ts: Date.now()
 });
 } else {
 db.ref(`comments/${activePostId}`).push({
 authorId: auth.currentUser.uid, authorName: myName, authorPhoto: myPhoto, text: text, ts: Date.now()
 });
 }
 spendAkho(0.5, 'Comment');
 document.getElementById('commInp').value = "";
 activeReplyTo = null;
 }
 function likeComment(commId) {
 if (!canAfford(0.1)) return;
 const ref = db.ref(`comments/${activePostId}/${commId}/likes/${auth.currentUser.uid}`);
 ref.once('value', snap => {
 if(snap.exists()) {
 ref.remove();
 } else {
 ref.set(true);
 spendAkho(0.1, 'Comment Like'); 
 }
 });
 }
 function openMessenger() {
 stopMainFeedVideos();
 document.getElementById('messengerUI').style.display = 'flex';
 const list = document.getElementById('chatList');
 list.innerHTML = "";
 db.ref(`users/${auth.currentUser.uid}/following`).on('value', snap => {
 list.innerHTML = "";
 const followers = snap.val();
 if(followers) {
 Object.entries(followers).forEach(([uid, data]) => {
 list.innerHTML += `
 <div class="chat-list-item" onclick="startChat('${uid}', '${data.name}', '${data.photo}')">
 <img src="${data.photo}" class="chat-list-ava">
 <b>${data.name}</b>
 </div>`;
 });
 } else { list.innerHTML = "<p style='padding:20px; color:gray;'>No contacts</p>"; }
 });
 }
 function startChat(uid, name, photo) {
 currentChatId = uid;
 document.getElementById('socialListsUI').style.display = 'none';
 document.getElementById('individualChat').style.display = 'flex';
 document.getElementById('chatTargetName').innerText = name;
 document.getElementById('chatTargetAva').src = photo;
 loadMessages(uid);
 listenToTyping(uid);
 }
 function closeChat() {
 if (currentChatId) db.ref(`typing/${getChatId(auth.currentUser.uid, currentChatId)}/${auth.currentUser.uid}`).remove();
 document.getElementById('individualChat').style.display = 'none';
 currentChatId = null;
 }

 function getChatId(u1, u2) {
 return u1 < u2 ? `${u1}_${u2}` : `${u2}_${u1}`;
 }

 function handleTyping() {
 if (!currentChatId) return;
 const chatId = getChatId(auth.currentUser.uid, currentChatId);
 db.ref(`typing/${chatId}/${auth.currentUser.uid}`).set(true);
 
 if (typingTimeout) clearTimeout(typingTimeout);
 typingTimeout = setTimeout(() => {
 db.ref(`typing/${chatId}/${auth.currentUser.uid}`).remove();
 }, 3000);
 }

 function listenToTyping(targetUid) {
 const chatId = getChatId(auth.currentUser.uid, targetUid);
 db.ref(`typing/${chatId}/${targetUid}`).on('value', snap => {
 const indicator = document.getElementById('typingIndicator');
 if (snap.exists()) {
 indicator.style.display = 'flex';
 document.getElementById('typingSound').play().catch(e => {});
 } else {
 indicator.style.display = 'none';
 }
 });
 }

 function listenToGlobalMessages() {
 const myUid = auth.currentUser.uid;
 db.ref('messages').on('child_added', snap => {
 // Listen to all chat rooms
 snap.ref.limitToLast(1).on('child_added', mSnap => {
 const msg = mSnap.val();
 if (!msg || msg.senderId === myUid) return;
 
 // Only notify if message is new (within last 10 seconds)
 if (Date.now() - msg.ts > 10000) return;

 // Check if current chat is not already open
 if (currentChatId && getChatId(myUid, currentChatId) === snap.key) return;

 // Find sender name and photo
 db.ref(`users/${msg.senderId}`).once('value', uSnap => {
 const u = uSnap.val();
 showGlobalPush(u.name, u.photo, msg.text);
 });
 });
 });
 }

 function showGlobalPush(name, photo, text) {
 const push = document.getElementById('globalPush');
 document.getElementById('pushName').innerText = name;
 document.getElementById('pushAva').src = photo;
 document.getElementById('pushTxt').innerText = text.substring(0, 40) + (text.length > 40 ? '...' : '');
 
 push.classList.add('show');
 document.getElementById('msgSound').play().catch(e => {});
 
 setTimeout(() => push.classList.remove('show'), 4000);
 }

 function loadMessages(targetUid) {
 const myUid = auth.currentUser.uid;
 const chatId = getChatId(myUid, targetUid);
 const box = document.getElementById('chatMessages');

 db.ref(`messages/${chatId}`).on('value', snap => {
 box.innerHTML = "";
 snap.forEach(child => {
 const msg = child.val();
 const type = msg.senderId === myUid ? 'sent' : 'received';
 
 // áƒ•áƒáƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒ—, áƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜áƒ áƒ—áƒ£ áƒáƒ£áƒ“áƒ˜áƒ áƒ¨áƒ”áƒ¢áƒ§áƒáƒ‘áƒ˜áƒœáƒ”áƒ‘áƒ
 let content = msg.text ? msg.text : `<audio src="${msg.audio}" controls style="width:200px; height:35px; outline:none;"></audio>`;
 
 box.innerHTML += `<div class="msg-bubble msg-${type}">${content}</div>`;
 });
 box.scrollTop = box.scrollHeight;
 });
}
 function sendMessage() {
 if (!canAfford(0.2)) return;
 const inp = document.getElementById('messageInp');
 if(!inp.value.trim() || !currentChatId) return;
 const myUid = auth.currentUser.uid;
 const chatId = getChatId(myUid, currentChatId);
 db.ref(`messages/${chatId}`).push({
 senderId: myUid,
 text: inp.value,
 ts: Date.now()
 });
 db.ref(`typing/${chatId}/${myUid}`).remove();
 spendAkho(0.2, 'Message');
 inp.value = "";
 }
 function openDiscovery() { 
 stopMainFeedVideos();
 document.getElementById('discoveryUI').style.display = 'flex'; 
 loadDiscoveryUsers();
 }
 function closeDiscovery() { 
 document.getElementById('discoveryUI').style.display = 'none'; 
 refreshHomeFeed();
 }
 function loadDiscoveryUsers() {
 db.ref('users').on('value', snap => {
 const users = snap.val();
 if (!users) return;
 const grid = document.getElementById('discoverGrid');
 grid.innerHTML = "";
 Object.entries(users).forEach(([uid, user]) => {
 if (uid === auth.currentUser.uid) return;
 const card = `
 <div class="user-card" onclick="openProfile('${uid}')">
 <div class="card-inner">
 <img src="${user.photo || 'https://ui-avatars.com/api/?name='+user.name}" class="discover-ava">
 <div class="discover-name">${user.name}</div>
 <div class="discover-status">EMIGRANT</div>
 </div>
 </div>`;
 grid.innerHTML += card;
 });
 });
 }

 function openSettings() {
 toggleSideMenu(false);
 stopMainFeedVideos();
 const ui = document.getElementById('settingsUI');
 ui.style.display = 'flex';
 const privacy = currentUserData.privacy || 'public';
 document.getElementById(`priv${privacy.charAt(0).toUpperCase() + privacy.slice(1)}`).checked = true;
 }

 function updatePrivacy(val) {
 db.ref(`users/${auth.currentUser.uid}`).update({ privacy: val });
 }

 function openProfile(uid) {
     window.lastOpenedUid = uid;
 stopMainFeedVideos();
 document.getElementById('profileUI').style.display = 'flex';
 
 if(uid !== auth.currentUser.uid) {
 db.ref(`profile_views/${uid}/${auth.currentUser.uid}`).set({
 uid: auth.currentUser.uid, name: myName, photo: myPhoto, ts: Date.now()
 });
 }

 db.ref('users/' + uid).on('value', async snap => {
 const user = snap.val();
 if(!user) return;
 
 const dot = document.getElementById('profStatusDot');
 const lastSeenSpan = document.getElementById('profLastSeenText');

 if(user.presence === 'online') {
 dot.className = 'status-dot online';
 lastSeenSpan.innerText = '';
 } else {
 const dynamicTime = formatTimeShort(user.presence);
 if(dynamicTime) {
 dot.className = 'status-dot offline';
 lastSeenSpan.innerText = dynamicTime;
 } else {
 dot.className = 'status-dot';
 }
 }

 document.getElementById('profAva').src = user.photo || "https://ui-avatars.com/api/?name=" + user.name;
 document.getElementById('profName').innerText = user.name;
 const followersCount = user.followers ? Object.keys(user.followers).length : 0;
 const followingCount = user.following ? Object.keys(user.following).length : 0;
 document.getElementById('statFollowersCount').innerText = followersCount;
 document.getElementById('statFollowingCount').innerText = followingCount;
 
 // Bind social lists clicks
 document.getElementById('followersStatBtn').onclick = () => openSocialList(uid, 'followers');
 document.getElementById('followingStatBtn').onclick = () => openSocialList(uid, 'following');

 const controls = document.getElementById('profControls');
 controls.innerHTML = "";
 
 document.querySelector('.profile-nav').style.display = 'flex';
 document.getElementById('feetStats').style.display = (uid === auth.currentUser.uid) ? 'block' : 'none';
 document.getElementById('profTabs').style.display = 'flex';

 document.getElementById('infoBtn').onclick = () => showDetailedInfo(uid);

 if(uid === auth.currentUser.uid) {
 controls.innerHTML = `<button class="profile-btn btn-gold" onclick="document.getElementById('avaInp').click()" data-key="edit">Edit</button>`;
 loadUserVideos(uid);
 applyLanguage();
 } else {
 const isFollowing = user.followers && user.followers[auth.currentUser.uid];
 const isFriend = user.following && user.following[auth.currentUser.uid] && isFollowing;
 
 let canView = false;
 if(!user.privacy || user.privacy === 'public') canView = true;
 if(user.privacy === 'friends' && isFriend) canView = true;
 
 if(canView) {
 loadUserVideos(uid);
 if(isFollowing) {
 controls.innerHTML = `
 <button class="profile-btn btn-outline" onclick="unfollowUser('${uid}')" data-key="following_btn">Following</button>
 <button class="profile-btn btn-outline" onclick="startChat('${uid}', '${user.name}', '${user.photo}')" data-key="write">Write</button>
 `;
 } else {
 controls.innerHTML = `
 <button class="profile-btn btn-gold" style="background:var(--gold); color:black;" onclick="followUser('${uid}', '${user.name}', '${user.photo}')" data-key="follow">Follow</button>
 <button class="profile-btn btn-outline" onclick="startChat('${uid}', '${user.name}', '${user.photo}')" data-key="write">Write</button>
 `;
 }
 } else {
 document.getElementById('profGrid').innerHTML = `<div class="private-lock-screen"><p data-key="private_profile">Private Profile</p></div>`;
 document.getElementById('profTabs').style.display = 'none';
 controls.innerHTML = `<button class="profile-btn btn-gold" onclick="followUser('${uid}', '${user.name}', '${user.photo}')" data-key="follow">Follow</button>`;
 }
 applyLanguage();
 }
 });
 }

 function showProfileVisitors() {
 document.getElementById('visitorsUI').style.display = 'flex';
 const list = document.getElementById('visitorsList');
 list.innerHTML = "Loading...";
 
 db.ref(`profile_views/${auth.currentUser.uid}`).once('value', async snap => {
 const data = snap.val();
 if(!data) { list.innerHTML = "No views"; return; }
 const myFollowingSnap = await db.ref(`users/${auth.currentUser.uid}/following`).once('value');
 const myFollowing = myFollowingSnap.val() || {};
 list.innerHTML = "";
 Object.values(data).reverse().forEach(v => {
 const isFollowing = myFollowing[v.uid];
 const followBtn = isFollowing ? 
 `<button class="profile-btn btn-outline" style="padding: 5px 12px; font-size: 11px;">${translations[currentLang].following_btn}</button>` :
 `<button class="profile-btn btn-gold" style="padding: 5px 12px; font-size: 11px;" onclick="followFromVisitors('${v.uid}', '${v.name}', '${v.photo}')">${translations[currentLang].follow}</button>`;

 list.innerHTML += `
 <div class="visitor-row">
 <div class="visitor-info" onclick="openProfile('${v.uid}'); document.getElementById('visitorsUI').style.display='none'">
 <img src="${v.photo}" class="visitor-ava">
 <b style="font-size:14px; color:white;">${v.name}</b>
 </div>
 <div>${v.uid !== auth.currentUser.uid ? followBtn : ''}</div>
 </div>`;
 });
 });
 }

 function openEditor() {
 toggleSideMenu(false);
 stopMainFeedVideos();
 const ui = document.getElementById('editProfileUI');
 ui.style.display = 'flex';
 document.getElementById('editName').value = currentUserData.name || "";
 document.getElementById('editCity').value = currentUserData.city || "";
 document.getElementById('editAge').value = currentUserData.age || "";
 document.getElementById('editRelation').value = currentUserData.relation || "Single";
 document.getElementById('editPhone').value = currentUserData.phone || "";
 }

 function saveProfileChanges() {
 const updates = {
 name: document.getElementById('editName').value,
 city: document.getElementById('editCity').value,
 age: document.getElementById('editAge').value,
 relation: document.getElementById('editRelation').value,
 phone: document.getElementById('editPhone').value
 };
 db.ref('users/' + auth.currentUser.uid).update(updates).then(() => {
 alert("Saved!");
 document.getElementById('editProfileUI').style.display = 'none';
 });
 }

 function showDetailedInfo(uid) {
 const panel = document.getElementById('userDetailedInfoUI');
 const content = document.getElementById('infoContent');
 panel.style.display = 'flex';
 content.innerHTML = "Loading...";

 db.ref('users/' + uid).once('value', snap => {
 const u = snap.val();
 if(!u) return;
 content.innerHTML = `
 <div class="info-row"><i class="fas fa-user"></i><div><span class="info-val-label">${translations[currentLang].full_name}</span><span class="info-val-text">${u.name || '-'}</span></div></div>
 <div class="info-row"><i class="fas fa-map-marker-alt"></i><div><span class="info-val-label">${translations[currentLang].location}</span><span class="info-val-text">${u.city || '-'}</span></div></div>
 <div class="info-row"><i class="fas fa-birthday-cake"></i><div><span class="info-val-label">${translations[currentLang].age}</span><span class="info-val-text">${u.age || '-'}</span></div></div>
 <div class="info-row"><i class="fas fa-heart"></i><div><span class="info-val-label">${translations[currentLang].relation}</span><span class="info-val-text">${u.relation || '-'}</span></div></div>
 <div class="info-row"><i class="fas fa-phone"></i><div><span class="info-val-label">${translations[currentLang].phone}</span><span class="info-val-text">${u.phone || '-'}</span></div></div>
 `;
 });
 }

 function followFromVisitors(uid, name, photo) {
 followUser(uid, name, photo);
 setTimeout(() => showProfileVisitors(), 500); 
 }

 function followUser(targetUid, name, photo) {
 if (!canAfford(1)) return;
 const myUid = auth.currentUser.uid;
 db.ref(`users/${myUid}/following/${targetUid}`).set({ name: name, photo: photo });
 db.ref(`users/${targetUid}/followers/${myUid}`).set({ name: myName, photo: myPhoto });
 db.ref(`notifications/${targetUid}`).push({
 text: `${myName} followed you`,
 ts: Date.now(),
 fromPhoto: myPhoto
 });
 spendAkho(1, 'Follow');
 }
 function unfollowUser(targetUid) {
 const myUid = auth.currentUser.uid;
 db.ref(`users/${myUid}/following/${targetUid}`).remove();
 db.ref(`users/${targetUid}/followers/${myUid}`).remove();
 }
 function listenToRequests() {
 const myUid = auth.currentUser.uid;
 db.ref(`notifications/${myUid}`).on('value', snap => {
 const data = snap.val();
 const count = data ? Object.keys(data).length : 0;
 const badge = document.getElementById('reqCount');
 if(count > 0) { badge.innerText = count; badge.style.display = 'block'; }
 else { badge.style.display = 'none'; }
 });
 }
 function openRequestsUI() {
 stopMainFeedVideos();
 document.getElementById('requestsUI').style.display = 'flex';
 const list = document.getElementById('reqList');
 db.ref(`notifications/${auth.currentUser.uid}`).once('value', snap => {
 list.innerHTML = "";
 const data = snap.val();
 if(data) {
 Object.entries(data).reverse().forEach(([id, notify]) => {
 list.innerHTML += `<div class="req-card"><div style="display:flex; align-items:center; gap:10px;"><img src="${notify.fromPhoto}" style="width:40px; height:40px; border-radius:50%;"><b style="font-size:14px; color:white;">${notify.text}</b></div><div><button class="profile-btn btn-outline" onclick="deleteNotification('${id}')">X</button></div></div>`;
 });
 } else { list.innerHTML = "<p style='text-align:center;'>No notifications</p>"; }
 });
 }
 function deleteNotification(id) {
 db.ref(`notifications/${auth.currentUser.uid}/${id}`).remove().then(() => openRequestsUI());
 }
 function loadUserVideos(uid) {
 const grid = document.getElementById('profGrid');
 grid.innerHTML = "";
 let vCount = 0;
 db.ref('posts').once('value', snap => {
 const posts = snap.val();
 if(!posts) return;
 Object.values(posts).forEach(post => {
 if(post.authorId === uid && post.media) {
 const video = post.media.find(m => m.type === 'video');
 if(video) {
 vCount++;
 const item = document.createElement('div');
 item.className = 'grid-item';
 item.innerHTML = `<video src="${video.url}" muted playsinline></video>`;
 item.onclick = () => playFullVideo(video.url);
 grid.appendChild(item);
 }
 }
 });
 document.getElementById('statVidsCount').innerText = vCount;
 });
 }
 function playFullVideo(url) {
 const overlay = document.getElementById('fullVideoOverlay');
 const vid = document.getElementById('fullVideoTag');
 vid.src = url; overlay.style.display = 'flex'; vid.play();
 }
 function closeFullVideo() {
 const overlay = document.getElementById('fullVideoOverlay');
 const vid = document.getElementById('fullVideoTag');
 vid.pause(); overlay.style.display = 'none';
 }
 function searchUsers(q) {
 const cards = document.querySelectorAll('.user-card');
 cards.forEach(c => {
 const name = c.querySelector('.discover-name').innerText.toLowerCase();
 c.style.display = name.includes(q.toLowerCase()) ? "block" : "none";
 });
 }

 function openSocialList(uid, type) {
 const ui = document.getElementById('socialListsUI');
 const title = document.getElementById('socialListTitle');
 const content = document.getElementById('socialContentArea');
 ui.style.display = 'flex';
 title.innerText = type === 'followers' ? 'áƒ’áƒáƒ›áƒáƒ›áƒ¬áƒ”áƒ áƒ”áƒ‘áƒ˜' : 'áƒ’áƒáƒ›áƒáƒ¬áƒ”áƒ áƒ˜áƒšáƒ˜áƒ';
 content.innerHTML = "áƒ˜áƒ¢áƒ•áƒ˜áƒ áƒ—áƒ”áƒ‘áƒ...";

 db.ref(`users/${uid}/${type}`).once('value', snap => {
 const list = snap.val();
 if(!list) { content.innerHTML = "<p style='text-align:center; margin-top:50px; color:gray;'>áƒ¡áƒ˜áƒ áƒªáƒáƒ áƒ˜áƒ”áƒšáƒ˜áƒ</p>"; return; }
 renderSocialList(list);
 });
 }

 function renderSocialList(list) {
 const content = document.getElementById('socialContentArea');
 content.innerHTML = "";
 Object.entries(list).forEach(([uid, u]) => {
 content.innerHTML += `
 <div class="social-item" data-name="${u.name.toLowerCase()}">
 <div class="social-user-info" onclick="document.getElementById('socialListsUI').style.display='none'; openProfile('${uid}')">
 <img src="${u.photo || 'https://ui-avatars.com/api/?name='+u.name}" class="social-ava">
 <div>
 <div class="social-name">${u.name}</div>
 <div class="social-status">Emigrant</div>
 </div>
 </div>
 <div class="social-actions-btns">
 <div class="social-msg-btn" onclick="startChat('${uid}', '${u.name}', '${u.photo}')">
 <i class="fas fa-comment"></i>
 </div>
 </div>
 </div>`;
 });
 }

 function filterSocialList(q) {
 const items = document.querySelectorAll('.social-item');
 items.forEach(item => {
 const name = item.getAttribute('data-name');
 item.style.display = name.includes(q.toLowerCase()) ? 'flex' : 'none';
 });
 }

 async function uploadNewAva(inp) {
 const file = inp.files[0];
 if(!file) return;
 const formData = new FormData();
 formData.append('image', file);
 try {
 const res = await fetch('https://api.imgbb.com/1/upload?key=20b1ff9fe9c8896477a6bf04c86bcc67', { method: 'POST', body: formData });
 const data = await res.json();
 if(data.success) {
 await db.ref('users/' + auth.currentUser.uid).update({ photo: data.data.url });
 alert("Done!");
 }
 } catch(e) { alert("Error!"); }
 }
 function logoutUser() {
 if(confirm("Logout?")) { auth.signOut().then(() => { location.reload(); }); }
 }
 
 function toggleAuthBox(type) {
 const loginBox = document.getElementById('loginBox');
 const regBox = document.getElementById('regBox');
 
 if (type === 'reg') {
 loginBox.style.display = 'none';
 regBox.style.display = 'block';
 } else {
 loginBox.style.display = 'block';
 regBox.style.display = 'none';
 }
}
 
 function handleAuth(type) {
 if (type === 'reg') {
 const email = document.getElementById('rEmail').value;
 const pass = document.getElementById('rPass').value;
 const name = document.getElementById('rFirstName').value + " " + document.getElementById('rLastName').value;
 auth.createUserWithEmailAndPassword(email, pass).then(u => {
 db.ref('users/' + u.user.uid).set({ name: name, akho: 50.00, photo: "", hasSeenRules: false, role: 'user', privacy: 'public', presence: Date.now() });
 addToLog('Welcome Bonus', 50.00);
 }).catch(err => alert(err.message));
 } else {
 const email = document.getElementById('uEmail').value;
 const pass = document.getElementById('uPass').value;
 auth.signInWithEmailAndPassword(email, pass).catch(err => alert(err.message));
 }
 }
 async function startTokenUpload() {
 if (!canAfford(5)) return;
 const file = document.getElementById('videoInput').files[0];
 if (!file) return alert("Select video");
 const btn = document.getElementById('upBtn');
 btn.disabled = true; btn.innerText = "Uploading...";
 const formData = new FormData();
 formData.append("file", file); formData.append("upload_preset", "Emigrantbook.video");
 try {
 const res = await fetch(`https://api.cloudinary.com/v1_1/djbgqzf6l/video/upload`, { method: 'POST', body: formData });
 const data = await res.json();
 if (data.secure_url) {
 await db.ref('posts').push({
 authorId: auth.currentUser.uid, authorName: myName, authorPhoto: myPhoto,
 text: document.getElementById('videoDesc').value,
 media: [{ url: data.secure_url, type: 'video' }],
 timestamp: Date.now()
 });
 spendAkho(5, 'Token Upload');
 location.reload();
 }
 } catch (err) { alert("Error!"); btn.disabled = false; btn.innerText = "Upload"; }
 }

 function togglePlayPause(vid) {
 if (vid.paused) vid.play();
 else vid.pause();
 }

function renderTokenFeed() {
 const feed = document.getElementById('main-feed');
 db.ref('posts').on('value', snap => {
 feed.innerHTML = "";
 const data = snap.val(); if (!data) return;

 // 1. áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒáƒ¡áƒ˜áƒ•áƒáƒ“ áƒ’áƒáƒ“áƒáƒ¥áƒªáƒ”áƒ•áƒ
 let postEntries = Object.entries(data);

 // 2. áƒ›áƒáƒ¡áƒ˜áƒ•áƒ˜áƒ¡ áƒáƒ áƒ”áƒ•áƒ (áƒ áƒáƒ› áƒ§áƒáƒ•áƒ”áƒšáƒ—áƒ•áƒ˜áƒ¡ áƒ¡áƒ®áƒ•áƒáƒ“áƒáƒ¡áƒ®áƒ•áƒ áƒ•áƒ˜áƒ“áƒ”áƒ áƒ˜áƒ§áƒáƒ¡ áƒáƒ˜áƒ áƒ•áƒ”áƒšáƒ˜)
 for (let i = postEntries.length - 1; i > 0; i--) {
 const j = Math.floor(Math.random() * (i + 1));
 [postEntries[i], postEntries[j]] = [postEntries[j], postEntries[i]];
 }

 // 3. áƒ£áƒ™áƒ•áƒ” áƒáƒ áƒ”áƒ£áƒšáƒ˜ áƒ›áƒáƒ¡áƒ˜áƒ•áƒ˜áƒ¡ áƒ’áƒáƒ›áƒáƒ¢áƒáƒœáƒ
 postEntries.forEach(([id, post]) => {
 if (post.media && post.media.some(m => m.type === 'video')) {
 const videoUrl = post.media.find(m => m.type === 'video').url;
 const likeCount = post.likedBy ? Object.keys(post.likedBy).length : 0;
 const shareCount = post.shares || 0;
 const saveCount = post.saves || 0;
 const card = document.createElement('div');
 card.className = 'video-card';
 card.id = `card-${id}`;
 const isLikedByMe = post.likedBy && post.likedBy[auth.currentUser.uid];
 const isSavedByMe = post.savedBy && post.savedBy[auth.currentUser.uid];

 card.innerHTML = `
 <video src="${videoUrl}" loop playsinline muted onclick="togglePlayPause(this)"></video>
 <div class="side-actions">
 <div style="position:relative">
 <img id="ava-${id}" src="https://ui-avatars.com/api/?name=${post.authorName}" class="author-mini-ava" onclick="openProfile('${post.authorId}')">
 <div id="mini-status-${id}" style="position:absolute; bottom:0; right:0; width:12px; height:12px; background:var(--green); border-radius:50%; border:2px solid #000; display:none;"></div>
 </div>
 <div class="action-item ${isLikedByMe ? 'liked' : ''}" onclick="react('${id}', '${post.authorId}')">
 <i class="fas fa-heart"></i>
 <span id="like-count-${id}">${likeCount}</span>
 </div>
 <div class="action-item" onclick="openComments('${id}')">
 <i class="fas fa-comment-dots"></i>
 <span id="comm-count-${id}">0</span>
 </div>
 <div class="action-item ${isSavedByMe ? 'saved' : ''}" onclick="toggleSavePost('${id}')">
 <i class="fas fa-bookmark"></i>
 <span id="save-count-${id}">${saveCount}</span>
 </div>
 <div class="action-item" onclick="shareVideo('${id}', '${videoUrl}')">
 <i class="fas fa-share"></i>
 <span id="share-count-${id}">${shareCount}</span>
 </div>
 ${post.authorId === auth.currentUser.uid ? `
 <div class="action-item" onclick="deleteMyVideo('${id}')" style="margin-top: 5px;">
 <i class="fas fa-trash-alt" style="color: #ff4d4d; font-size: 20px;"></i>
 <span style="color: #ff4d4d; font-size: 10px;">DEL</span>
 </div>
 ` : ''}
 </div>
 <div style="position:absolute; left:15px; bottom:90px; text-shadow:2px 2px 4px #000; pointer-events:none;">
 <b id="name-${id}" style="color:var(--gold); cursor:pointer; pointer-events:auto;" onclick="openProfile('${post.authorId}')">@${post.authorName}</b>
 <p style="font-size:14px; margin-top:6px;">${post.text || ''}</p>
 </div>`;
 feed.appendChild(card);
 
 db.ref(`comments/${id}`).on('value', cSnap => {
 const count = cSnap.val() ? Object.keys(cSnap.val()).length : 0;
 if(document.getElementById(`comm-count-${id}`)) document.getElementById(`comm-count-${id}`).innerText = count;
 });

 db.ref(`users/${post.authorId}`).on('value', uSnap => {
 const u = uSnap.val();
 if(u && u.photo) document.getElementById(`ava-${id}`).src = u.photo;
 if(u && u.name) document.getElementById(`name-${id}`).innerText = "@" + u.name;
 if(u && u.presence === 'online') document.getElementById(`mini-status-${id}`).style.display = 'block';
 else if(document.getElementById(`mini-status-${id}`)) document.getElementById(`mini-status-${id}`).style.display = 'none';
 });
 }
 });
 setupAutoPlay();
 });
}

 function setupAutoPlay() {
 const observer = new IntersectionObserver((entries) => {
 entries.forEach(entry => {
 const video = entry.target.querySelector('video');
 if (entry.isIntersecting) { 
 if (document.getElementById('profileUI').style.display !== 'flex' && 
 document.getElementById('discoveryUI').style.display !== 'flex') {
 video.muted = false; 
 video.play().catch(e => {}); 
 }
 }
 else { video.pause(); video.muted = true; }
 });
 }, { root: document.getElementById('main-feed'), threshold: 0.6 });
 document.querySelectorAll('.video-card').forEach(card => observer.observe(card));
 }

 function react(postId, ownerUid) {
 if (!canAfford(0.1)) return;
 const user = auth.currentUser;
 if (!user) return;

 const likeRef = db.ref(`posts/${postId}/likedBy/${user.uid}`);
 likeRef.once('value', snap => {
 if (snap.exists()) {
 // áƒ—áƒ£ áƒ£áƒ™áƒ•áƒ” áƒ“áƒáƒšáƒáƒ˜áƒ¥áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ, áƒ•áƒáƒ¨áƒáƒ áƒ”áƒ‘áƒ— áƒšáƒáƒ˜áƒ¥áƒ¡ (áƒ—áƒáƒœáƒ®áƒ áƒáƒ¦áƒáƒ  áƒ‘áƒ áƒ£áƒœáƒ“áƒ”áƒ‘áƒ)
 likeRef.remove();
 } else {
 // áƒáƒ®áƒáƒšáƒ˜ áƒšáƒáƒ˜áƒ¥áƒ˜áƒ¡ áƒ“áƒáƒ“áƒ”áƒ‘áƒ
 likeRef.set({ type: 'â¤ï¸', photo: myPhoto, name: myName });
 
 // 1. áƒ§áƒáƒ•áƒ”áƒšáƒ—áƒ•áƒ˜áƒ¡ áƒ•áƒáƒ™áƒšáƒ”áƒ‘áƒ— 0.1-áƒ¡ áƒ›áƒáƒ¡, áƒ•áƒ˜áƒœáƒª áƒáƒ­áƒ”áƒ áƒ¡ (áƒ áƒáƒ› "áƒ£áƒ¤áƒáƒ¡áƒ" áƒáƒ  áƒ˜áƒ§áƒáƒ¡)
 spendAkho(0.1, 'Like'); 

 // 2. áƒ›áƒ—áƒáƒ•áƒáƒ áƒ˜ áƒ“áƒáƒªáƒ•áƒ: áƒ›áƒ®áƒáƒšáƒáƒ“ áƒ—áƒ£ áƒ¡áƒ®áƒ•áƒ˜áƒ¡ áƒ•áƒ˜áƒ“áƒ”áƒáƒ¡ áƒ•áƒáƒšáƒáƒ˜áƒ¥áƒ”áƒ‘áƒ—, áƒ›áƒáƒ¨áƒ˜áƒœ áƒ˜áƒ áƒ˜áƒªáƒ®áƒ”áƒ‘áƒ 2.00
 if (ownerUid !== user.uid) {
 earnAkho(ownerUid, 2.00, 'Impact (Like)'); 
 } else {
 console.log("áƒ¡áƒáƒ™áƒ£áƒ—áƒáƒ  áƒ•áƒ˜áƒ“áƒ”áƒáƒ–áƒ” AKHO áƒáƒ  áƒ˜áƒ áƒ˜áƒªáƒ®áƒ”áƒ‘áƒ.");
 }
 }
 });
}

 function toggleSavePost(postId) {
 const user = auth.currentUser;
 if(!user) return;
 const saveRef = db.ref(`posts/${postId}/savedBy/${user.uid}`);
 saveRef.once('value', snap => {
 if(snap.exists()) {
 saveRef.remove();
 db.ref(`posts/${postId}/saves`).transaction(c => (c || 1) - 1);
 } else {
 saveRef.set(true);
 db.ref(`posts/${postId}/saves`).transaction(c => (c || 0) + 1);
 }
 });
 }

 function shareVideo(postId, url) {
 if (navigator.share) {
 navigator.share({ url: url }).then(() => {
 db.ref(`posts/${postId}/shares`).transaction(c => (c || 0) + 1);
 });
 } else {
 alert("Link: " + url);
 db.ref(`posts/${postId}/shares`).transaction(c => (c || 0) + 1);
 }
 }
 
 
 // áƒ’áƒ•áƒ”áƒ áƒ“áƒ˜áƒ¡ áƒ›áƒáƒ áƒ—áƒ•áƒ
function openCommunityWall() {
 stopMainFeedVideos(); // áƒ•áƒáƒ©áƒ”áƒ áƒ”áƒ‘áƒ— áƒ•áƒ˜áƒ“áƒ”áƒáƒ”áƒ‘áƒ¡, áƒ áƒáƒ› áƒ®áƒ›áƒ áƒáƒ  áƒ›áƒáƒ’áƒ•áƒ”áƒ¡áƒ›áƒáƒ¡
 document.getElementById('communityWallUI').style.display = 'flex';
 document.getElementById('wallMyAva').src = myPhoto;
 loadCommunityPosts();
}

function closeCommunityWall() {
 document.getElementById('communityWallUI').style.display = 'none';
}

// áƒ¤áƒáƒ¢áƒáƒ¡ áƒáƒ áƒ©áƒ”áƒ•áƒ áƒ“áƒ áƒáƒ áƒ”áƒ•áƒ˜áƒ£
function previewWallImage(input) {
 if (input.files && input.files[0]) {
 const reader = new FileReader();
 reader.onload = e => {
 document.getElementById('wallImgPreview').src = e.target.result;
 document.getElementById('wallImgPreviewBox').style.display = 'block';
 }
 reader.readAsDataURL(input.files[0]);
 }
}

function cancelWallImg() {
 document.getElementById('wallImgInput').value = "";
 document.getElementById('wallImgPreviewBox').style.display = 'none';
}

async function submitWallPost() {
 const text = document.getElementById('wallPostText').value;
 const file = document.getElementById('wallImgInput').files[0];
 
 if(!text.trim() && !file) return alert("áƒ“áƒáƒ¬áƒ”áƒ áƒ”áƒ— áƒ áƒáƒ›áƒ” áƒáƒœ áƒáƒ˜áƒ áƒ©áƒ˜áƒ”áƒ— áƒ¤áƒáƒ¢áƒ");
 if(!canAfford(2)) return; 

 const btn = document.querySelector('[onclick="submitWallPost()"]');
 btn.disabled = true; btn.innerText = "...";

 let finalUrl = "";
 
 if(file) {
 const formData = new FormData();
 formData.append("file", file);
 formData.append("upload_preset", "Emigrantbook.video"); 
 
 try {
 // áƒáƒ¥ áƒ“áƒáƒ•áƒáƒ›áƒáƒ¢áƒ”áƒ— resource_type=auto, áƒ áƒáƒ› Cloudinary-áƒ› áƒ¤áƒáƒ¢áƒ áƒáƒ¦áƒáƒ  áƒ“áƒáƒ‘áƒšáƒáƒ™áƒáƒ¡
 const res = await fetch(`https://api.cloudinary.com/v1_1/djbgqzf6l/auto/upload`, { 
 method: 'POST', 
 body: formData 
 });
 const data = await res.json();
 
 if (data.secure_url) {
 finalUrl = data.secure_url;
 } else {
 console.error("Upload failed:", data);
 alert("áƒ¤áƒáƒ¢áƒáƒ¡ áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ áƒ•áƒ”áƒ  áƒ›áƒáƒ®áƒ”áƒ áƒ®áƒ“áƒ. áƒ¨áƒ”áƒáƒ›áƒáƒ¬áƒ›áƒ” Cloudinary Preset.");
 btn.disabled = false; btn.innerText = "áƒ’áƒáƒ›áƒáƒ¥áƒ•áƒ”áƒ§áƒœáƒ”áƒ‘áƒ";
 return;
 }
 } catch (err) {
 console.error("Fetch error:", err);
 alert("áƒ™áƒáƒ•áƒ¨áƒ˜áƒ áƒ˜áƒ¡ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ!");
 btn.disabled = false; btn.innerText = "áƒ’áƒáƒ›áƒáƒ¥áƒ•áƒ”áƒ§áƒœáƒ”áƒ‘áƒ";
 return;
 }
 }

 // Firebase-áƒ¨áƒ˜ áƒ¨áƒ”áƒœáƒáƒ®áƒ•áƒ
 await db.ref('community_posts').push({
 authorId: auth.currentUser.uid,
 authorName: myName,
 authorPhoto: myPhoto,
 text: text,
 image: finalUrl,
 timestamp: Date.now()
 });

 spendAkho(2, 'Community Post');
 document.getElementById('wallPostText').value = "";
 cancelWallImg();
 btn.disabled = false; btn.innerText = "áƒ’áƒáƒ›áƒáƒ¥áƒ•áƒ”áƒ§áƒœáƒ”áƒ‘áƒ";
}

// áƒáƒáƒ¡áƒ¢áƒ”áƒ‘áƒ˜áƒ¡ áƒ©áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ áƒ˜áƒ›áƒáƒ•áƒ” áƒ’áƒ•áƒ”áƒ áƒ“áƒ–áƒ”
function loadCommunityPosts() {
 const box = document.getElementById('communityPostsList');
 db.ref('community_posts').orderByChild('timestamp').on('value', snap => {
 box.innerHTML = "";
 const data = snap.val();
 if(!data) return;
 
 Object.entries(data).reverse().forEach(([id, post]) => {
 const card = document.createElement('div');
 card.style = "background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 15px;";
 card.innerHTML = `
 <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
 <img src="${post.authorPhoto}" style="width: 35px; height: 35px; border-radius: 50%; border: 1px solid var(--gold);">
 <b style="color: white; font-size: 14px;">${post.authorName}</b>
 </div>
 ${post.text ? `<p style="font-size: 15px; margin-bottom: 10px; color: #E4E6EB;">${post.text}</p>` : ''}
 ${post.image ? `<img src="${post.image}" style="width: 100%; border-radius: 10px; margin-bottom: 10px;">` : ''}
 <div style="display: flex; gap: 20px; color: var(--gold); border-top: 1px solid #333; padding-top: 10px;">
 <i class="far fa-heart" style="cursor:pointer;"></i>
 <i class="far fa-comment" style="cursor:pointer;" onclick="openComments('${id}')"></i>
 </div>
 `;
 box.appendChild(card);
 });
 });
}





let mediaRecorder;
let audioChunks = [];

async function toggleVoiceRecord() {
 const micIcon = document.getElementById('micIcon');
 
 if (!mediaRecorder || mediaRecorder.state === "inactive") {
 // áƒ©áƒáƒ¬áƒ”áƒ áƒ˜áƒ¡ áƒ“áƒáƒ¬áƒ§áƒ”áƒ‘áƒ
 const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
 mediaRecorder = new MediaRecorder(stream);
 audioChunks = [];

 mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
 mediaRecorder.onstop = async () => {
 const audioBlob = new Blob(audioChunks, { type: 'audio/mp3' });
 sendVoiceMessage(audioBlob);
 };

 mediaRecorder.start();
 micIcon.classList.replace('fa-microphone', 'fa-stop-circle');
 micIcon.style.color = "var(--red)";
 console.log("áƒ©áƒáƒ¬áƒ”áƒ áƒ áƒ“áƒáƒ˜áƒ¬áƒ§áƒ...");
 } else {
 // áƒ©áƒáƒ¬áƒ”áƒ áƒ˜áƒ¡ áƒ“áƒáƒ¡áƒ áƒ£áƒšáƒ”áƒ‘áƒ
 mediaRecorder.stop();
 micIcon.classList.replace('fa-stop-circle', 'fa-microphone');
 micIcon.style.color = "var(--gold)";
 }
}

async function sendVoiceMessage(blob) {
 if (!canAfford(0.5)) return; // áƒ®áƒ›áƒáƒ•áƒáƒœáƒ˜ áƒ¨áƒ”áƒ¢áƒ§áƒáƒ‘áƒ˜áƒœáƒ”áƒ‘áƒ 0.5 AKHO

 const formData = new FormData();
 formData.append("file", blob);
 formData.append("upload_preset", "Emigrantbook.video"); 

 try {
 const res = await fetch(`https://api.cloudinary.com/v1_1/djbgqzf6l/auto/upload`, { method: 'POST', body: formData });
 const data = await res.json();
 
 if (data.secure_url) {
 const myUid = auth.currentUser.uid;
 const chatId = getChatId(myUid, currentChatId);
 db.ref(`messages/${chatId}`).push({
 senderId: myUid,
 audio: data.secure_url,
 ts: Date.now()
 });
 spendAkho(0.5, 'Voice Message');
 }
 } catch (err) { alert("áƒ®áƒ›áƒ˜áƒ¡ áƒ’áƒáƒ’áƒ–áƒáƒ•áƒœáƒ áƒ•áƒ”áƒ  áƒ›áƒáƒ®áƒ”áƒ áƒ®áƒ“áƒ"); }
}






function deleteMyVideo(postId) {
 if(confirm("áƒœáƒáƒ›áƒ“áƒ•áƒ˜áƒšáƒáƒ“ áƒ’áƒ¡áƒ£áƒ áƒ— áƒ¬áƒáƒ¨áƒšáƒ?")) {
 db.ref(`posts/${postId}`).remove().then(() => {
 console.log("áƒ•áƒ˜áƒ“áƒ”áƒ áƒ¬áƒáƒ˜áƒ¨áƒáƒšáƒ");
 });
 }
}



// --- áƒ•áƒ˜áƒ“áƒ”áƒ áƒ–áƒáƒ áƒ˜áƒ¡ áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒ”áƒ‘áƒ˜áƒ¡ áƒ¡áƒ áƒ£áƒšáƒ˜ áƒ‘áƒšáƒáƒ™áƒ˜ ---
let localTracks = { videoTrack: null, audioTrack: null };

async function startVideoCall(existingChannel = null) {
    const appId = "7290502fac7f4feb82b021ccde79988a"; 
    const token = "007eJxTYHjuUsbf/kPswi7dW9OuT2ywvjBtv5XPYkdtPofrzS5ztX4oMJgbWRqYGhilJSabp5mkpSZZGCUZGBkmJ6ekmltaWlgkMk/ryWwIZGRotNBnYmSAQBCfmyEnsyw1vrikKDUxl4EBAEnPIfQ=";
    const channel = "live_stream"; 
    
    // áƒ–áƒáƒ áƒ˜áƒ¡ áƒ®áƒ›áƒ˜áƒ¡ áƒ©áƒáƒ áƒ—áƒ•áƒ
    const ring = document.getElementById('ringtone');
    if (ring) ring.play().catch(e => console.log("Audio play blocked"));

    const ui = document.getElementById('videoCallUI');
    ui.style.display = 'flex';
    ui.style.zIndex = "200000"; // áƒ§áƒ•áƒ”áƒšáƒáƒ–áƒ” áƒ–áƒ”áƒ›áƒáƒ— áƒáƒ›áƒáƒ¬áƒ”áƒ•áƒ
    ui.style.width = '100%';
    ui.style.height = '100%';

    try {
        const uid = Math.floor(Math.random() * 10000);
        await client.join(appId, channel, token, uid);
        
        localTracks.audioTrack = await AgoraRTC.createMicrophoneAudioTrack();
        localTracks.videoTrack = await AgoraRTC.createCameraVideoTrack();
        
        localTracks.videoTrack.play("local-video");
        await client.publish([localTracks.audioTrack, localTracks.videoTrack]);

        if (!existingChannel) {
            db.ref(`video_calls/${currentChatId}`).set({
                callerName: myName,
                callerPhoto: myPhoto,
                callerUid: auth.currentUser.uid,
                channel: channel,
                status: 'calling',
                ts: Date.now()
            });
        }
    } catch (err) {
        if (ring) ring.pause();
        alert("áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ áƒ™áƒáƒ›áƒ”áƒ áƒ˜áƒ¡ áƒ©áƒáƒ áƒ—áƒ•áƒ˜áƒ¡áƒáƒ¡!");
        endVideoCall(); 
    }
}

// áƒáƒ› áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒáƒ¨áƒ˜ áƒ“áƒáƒ•áƒáƒ›áƒáƒ¢áƒ” áƒ®áƒ›áƒ˜áƒ¡ áƒ’áƒáƒ—áƒ˜áƒ¨áƒ•áƒ
async function endVideoCall() {
    // áƒ–áƒáƒ áƒ˜áƒ¡ áƒ®áƒ›áƒ˜áƒ¡ áƒ’áƒáƒ—áƒ˜áƒ¨áƒ•áƒ
    const ring = document.getElementById('ringtone');
    if (ring) { ring.pause(); ring.currentTime = 0; }

    if (localTracks.audioTrack) { localTracks.audioTrack.stop(); localTracks.audioTrack.close(); }
    if (localTracks.videoTrack) { localTracks.videoTrack.stop(); localTracks.videoTrack.close(); }
    localTracks = { videoTrack: null, audioTrack: null };

    await client.leave();
    document.getElementById('videoCallUI').style.display = 'none';
    
    if(currentChatId) db.ref(`video_calls/${currentChatId}`).remove();
    db.ref(`video_calls/${auth.currentUser.uid}`).remove();
}

function minimizeVideoCall() {
 const ui = document.getElementById('videoCallUI');
 if(ui.style.width === '100%') {
 ui.style.width = '140px'; ui.style.height = '200px';
 ui.style.top = '70px'; ui.style.left = '10px';
 ui.style.borderRadius = '15px';
 ui.style.border = '2px solid var(--gold)';
 } else {
 ui.style.width = '100%'; ui.style.height = '100%';
 ui.style.top = '0'; ui.style.left = '0';
 ui.style.borderRadius = '0';
 ui.style.border = 'none';
 }
}







// --- TIKTOK STYLE LIVE LOGIC (FINAL UPDATED) ---
let liveClient = AgoraRTC.createClient({ mode: "live", codec: "vp8" });
let liveTracks = { video: null, audio: null };
let currentLiveChannel = null;

// áƒ›áƒ”áƒœáƒ˜áƒ£áƒ“áƒáƒœ áƒ’áƒáƒ›áƒáƒ«áƒáƒ®áƒ”áƒ‘áƒ
function startLiveFunc() {
 toggleSideMenu(false);
 startLive();
}

async function startLive() {
 // áƒ¨áƒ”áƒœáƒ˜ áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ”áƒ‘áƒ˜ áƒ©áƒáƒ¡áƒ›áƒ£áƒšáƒ˜áƒ áƒáƒ¥
 const appId = "7290502fac7f4feb82b021ccde79988a"; 
 const token = "007eJxTYNhXO5N5SfvCzGM3PX7ELlx/wl3aS2uOSOv9qBmvGXn+z+RQYDA3sjQwNTBKS0w2TzNJS02yMEoyMDJMTk5JNbe0tLBIdH3Sm9kQyMiw8mwpIyMDBIL43Aw5mWWp8cUlRamJuQwMAHdWI2c=";
 
 // áƒ›áƒœáƒ˜áƒ¨áƒ•áƒœáƒ”áƒšáƒáƒ•áƒáƒœáƒ˜: áƒ¢áƒáƒ™áƒ”áƒœáƒ˜áƒ¡ áƒáƒ¦áƒ”áƒ‘áƒ˜áƒ¡áƒáƒ¡ áƒ—áƒ£ áƒ©áƒ”áƒœáƒ”áƒšáƒ¡ áƒ¡áƒáƒ®áƒ”áƒšáƒ˜ áƒáƒ  áƒ“áƒáƒáƒ áƒ¥áƒ•áƒ˜, áƒáƒ¥ "live_stream" áƒ£áƒœáƒ“áƒ áƒ˜áƒ§áƒáƒ¡
 currentLiveChannel = "live_stream"; 
 
 document.getElementById('liveUI').style.display = 'flex';
 document.getElementById('liveHostName').innerText = myName;
 document.getElementById('liveHostAva').src = myPhoto;

 try {
 await liveClient.setClientRole("host");
 
 // áƒ¢áƒáƒ™áƒ”áƒœáƒ˜áƒ— áƒ¨áƒ”áƒ¡áƒ•áƒšáƒ
 await liveClient.join(appId, currentLiveChannel, token, auth.currentUser.uid);
 
 liveTracks.audio = await AgoraRTC.createMicrophoneAudioTrack();
 liveTracks.video = await AgoraRTC.createCameraVideoTrack();
 
 liveTracks.video.play("remote-live-video");
 await liveClient.publish([liveTracks.audio, liveTracks.video]);

 // Firebase-áƒ¨áƒ˜ áƒšáƒáƒ˜áƒ•áƒ˜áƒ¡ áƒ’áƒáƒáƒ¥áƒ¢áƒ˜áƒ£áƒ áƒ”áƒ‘áƒ
 db.ref(`lives/${auth.currentUser.uid}`).set({
 hostId: auth.currentUser.uid,
 hostName: myName,
 hostPhoto: myPhoto,
 channel: currentLiveChannel,
 status: 'active',
 ts: Date.now()
 });

 listenToLiveChat(currentLiveChannel);
 } catch (e) {
 console.error("Agora Error:", e);
 alert("áƒšáƒáƒ˜áƒ•áƒ˜ áƒ•áƒ”áƒ  áƒ“áƒáƒ˜áƒ¬áƒ§áƒ. áƒ¨áƒ”áƒáƒ›áƒáƒ¬áƒ›áƒ” HTTPS áƒáƒœ áƒ¢áƒáƒ™áƒ”áƒœáƒ˜!");
 endLive();
 }
}

function listenToLiveChat(channel) {
    const chatBox = document.getElementById('liveChatBox');
    // áƒ›áƒáƒ•áƒáƒ¨áƒáƒ áƒáƒ— pointer-events: none, áƒ áƒáƒ› áƒ¡áƒ¥áƒ áƒáƒšáƒ˜ áƒ¨áƒ”áƒ«áƒšáƒáƒ¡ áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ›áƒ
    chatBox.style.pointerEvents = "auto"; 
    
    db.ref(`live_chats/${channel}`).limitToLast(20).on('child_added', snap => {
        const msg = snap.val();
        const div = document.createElement('div');
        
        // áƒ¡áƒ¢áƒ˜áƒšáƒ˜ áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ£áƒ áƒ˜ áƒ“áƒ áƒ©áƒ•áƒ”áƒ£áƒšáƒ”áƒ‘áƒ áƒ˜áƒ•áƒ˜ áƒ›áƒ”áƒ¡áƒ˜áƒ¯áƒ”áƒ‘áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡
        if(msg.name === "SYSTEM") {
            div.style = "background:rgba(212,175,55,0.2); padding:8px 12px; border-radius:10px; margin-bottom:5px; border:1px solid var(--gold); animation: flash 1s;";
            div.innerHTML = `<span style="color:var(--gold); font-size:13px; font-weight:bold;">${msg.text}</span>`;
        } else {
            div.style = "background:rgba(0,0,0,0.4); padding:6px 12px; border-radius:15px; margin-bottom:5px; width:fit-content; border-left:3px solid var(--gold);";
            div.innerHTML = `<b style="color:var(--gold); font-size:12px;">${msg.name}:</b> <span style="color:white; font-size:13px;">${msg.text}</span>`;
        }
        
        chatBox.appendChild(div);
        
        // áƒáƒ•áƒ¢áƒáƒ›áƒáƒ¢áƒ£áƒ áƒ˜ áƒ¡áƒ¥áƒ áƒáƒšáƒ˜ áƒ‘áƒáƒšáƒ áƒ›áƒ”áƒ¡áƒ˜áƒ¯áƒ–áƒ”
        chatBox.scrollTo({
            top: chatBox.scrollHeight,
            behavior: 'smooth'
        });
    });
}

function sendLiveComment() {
 const inp = document.getElementById('liveMsgInp');
 if(!inp.value.trim() || !currentLiveChannel) return;
 db.ref(`live_chats/${currentLiveChannel}`).push({
 name: myName,
 text: inp.value,
 ts: Date.now()
 });
 inp.value = "";
}

async function endLive() {
 if (liveTracks.video) { liveTracks.video.stop(); liveTracks.video.close(); }
 if (liveTracks.audio) { liveTracks.audio.stop(); liveTracks.audio.close(); }
 await liveClient.leave();
 document.getElementById('liveUI').style.display = 'none';
 if (currentLiveChannel && currentLiveChannel.includes(auth.currentUser.uid)) {
 db.ref(`lives/${auth.currentUser.uid}`).remove();
 db.ref(`live_chats/${currentLiveChannel}`).remove();
 }
}

// áƒ’áƒ£áƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒáƒœáƒ˜áƒ›áƒáƒªáƒ˜áƒ (TikTok Style)
function sendLiveHeart() {
 const container = document.getElementById('live-video-container');
 const heart = document.createElement('i');
 heart.className = "fas fa-heart";
 heart.style.position = "absolute";
 heart.style.right = "20px";
 heart.style.bottom = "150px";
 heart.style.color = `hsl(${Math.random() * 360}, 100%, 50%)`;
 heart.style.fontSize = "24px";
 heart.style.transition = "all 1s ease-out";
 heart.style.zIndex = "100";
 
 container.appendChild(heart);
 
 setTimeout(() => {
 heart.style.bottom = "400px";
 heart.style.right = (Math.random() * 100) + "px";
 heart.style.opacity = "0";
 }, 50);
 
 setTimeout(() => heart.remove(), 1000);
}

// --- áƒ¡áƒ®áƒ•áƒ áƒ“áƒáƒ›áƒ®áƒ›áƒáƒ áƒ” áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒ”áƒ‘áƒ˜ ---
function nextObSlide(n) {
 document.querySelectorAll('.ob-step').forEach(s => s.style.display = 'none');
 document.getElementById('obSlide' + n).style.display = 'block';
}

function runSuccessAndFinish() {
 document.getElementById('rulesList').style.display = 'none';
 document.getElementById('finishBtn').style.display = 'none';
 const animBox = document.getElementById('tokenSuccessAnim');
 animBox.style.display = 'block';
 animBox.classList.add('token-pop');
 setTimeout(() => finishOnboarding(), 1800);
}

function finishOnboarding() {
 const user = auth.currentUser;
 if (user) db.ref('users/' + user.uid).update({ hasSeenRules: true });
 document.getElementById('onboardingUI').style.display = 'none';
}



// áƒ¡áƒáƒ©áƒ£áƒ¥áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒáƒáƒœáƒ”áƒšáƒ˜áƒ¡ áƒ’áƒáƒ›áƒáƒ©áƒ”áƒœáƒ/áƒ“áƒáƒ›áƒáƒšáƒ•áƒ
function toggleGiftPanel() {
    const p = document.getElementById('giftPanel');
    p.style.display = p.style.display === 'none' ? 'block' : 'none';
}

// áƒ¡áƒáƒ©áƒ£áƒ¥áƒ áƒ˜áƒ¡ áƒ’áƒáƒ’áƒ–áƒáƒ•áƒœáƒ˜áƒ¡ áƒ«áƒ˜áƒ áƒ˜áƒ—áƒáƒ“áƒ˜ áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒ
function sendGift(emoji, price, giftName) {
    // 1. áƒ•áƒáƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒ—, áƒáƒ¥áƒ•áƒ¡ áƒ—áƒ£ áƒáƒ áƒ áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ¡ áƒ¡áƒáƒ™áƒ›áƒáƒ áƒ˜áƒ¡áƒ˜ AKHO
    if (myAkho < price) {
        alert(currentLang === 'ka' ? "áƒ‘áƒáƒšáƒáƒœáƒ¡áƒ˜ áƒáƒ  áƒ’áƒáƒ¥áƒ•áƒ¡ áƒ¡áƒáƒ™áƒ›áƒáƒ áƒ˜áƒ¡áƒ˜!" : "Not enough balance!");
        openWalletUI();
        return;
    }

    // 2. áƒ•áƒáƒ“áƒ’áƒ”áƒœáƒ— áƒ•áƒ˜áƒœ áƒáƒ áƒ˜áƒ¡ áƒšáƒáƒ˜áƒ•áƒ˜áƒ¡ áƒ°áƒáƒ¡áƒ¢áƒ˜ (áƒ•áƒ˜áƒ¡ áƒ£áƒœáƒ“áƒ áƒ©áƒáƒ”áƒ áƒ˜áƒªáƒ®áƒáƒ¡ áƒ¤áƒ£áƒšáƒ˜)
    // áƒ©áƒ”áƒœáƒ”áƒšáƒ˜áƒ¡ áƒ¡áƒáƒ®áƒ”áƒšáƒ˜áƒ“áƒáƒœ (live_UID) áƒ•áƒ˜áƒ¦áƒ”áƒ‘áƒ— áƒ°áƒáƒ¡áƒ¢áƒ˜áƒ¡ ID-áƒ¡
    const hostUid = currentLiveChannel.replace("live_", "");

    // 3. áƒ•áƒáƒ™áƒšáƒ”áƒ‘áƒ— áƒ¤áƒ£áƒšáƒ¡ áƒ’áƒáƒ›áƒ’áƒ–áƒáƒ•áƒœáƒ¡
    spendAkho(price, `Sent Gift: ${giftName}`);

    // 4. áƒ•áƒ£áƒ›áƒáƒ¢áƒ”áƒ‘áƒ— áƒ¤áƒ£áƒšáƒ¡ áƒ°áƒáƒ¡áƒ¢áƒ¡
    earnAkho(hostUid, price, `Received Gift: ${giftName}`);

    // 5. áƒ•áƒáƒ’áƒ–áƒáƒ•áƒœáƒ˜áƒ— áƒ˜áƒœáƒ¤áƒáƒ áƒ›áƒáƒªáƒ˜áƒáƒ¡ Firebase-áƒ¨áƒ˜, áƒ áƒáƒ› áƒ§áƒ•áƒ”áƒšáƒáƒ› áƒ“áƒáƒ˜áƒœáƒáƒ®áƒáƒ¡ áƒ¡áƒáƒ©áƒ£áƒ¥áƒáƒ áƒ˜
    db.ref(`live_chats/${currentLiveChannel}`).push({
        name: "SYSTEM",
        text: `ğŸ ${myName}-áƒ›áƒ áƒ’áƒáƒ©áƒ£áƒ¥áƒ ${giftName} ${emoji}`,
        ts: Date.now()
    });

    // 6. áƒ•áƒ£áƒ¨áƒ•áƒ”áƒ‘áƒ— áƒ•áƒ˜áƒ–áƒ£áƒáƒšáƒ£áƒ  áƒáƒœáƒ˜áƒ›áƒáƒªáƒ˜áƒáƒ¡ áƒ”áƒ™áƒ áƒáƒœáƒ–áƒ”
    showGiftAnimation(emoji);
    
    // áƒ•áƒ®áƒ£áƒ áƒáƒ•áƒ— áƒáƒáƒœáƒ”áƒšáƒ¡
    toggleGiftPanel();
}

// áƒ¡áƒáƒ©áƒ£áƒ¥áƒ áƒ˜áƒ¡ áƒáƒœáƒ˜áƒ›áƒáƒªáƒ˜áƒ (áƒ”áƒ™áƒ áƒáƒœáƒ˜áƒ¡ áƒªáƒ”áƒœáƒ¢áƒ áƒ¨áƒ˜ áƒáƒ›áƒáƒ®áƒ¢áƒáƒ›áƒ)
function showGiftAnimation(emoji) {
    const container = document.getElementById('live-video-container');
    const giftEl = document.createElement('div');
    
    giftEl.style = `
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        font-size: 100px;
        z-index: 100001;
        pointer-events: none;
        animation: gift-pop-up 2s ease-out forwards;
    `;
    
    giftEl.innerText = emoji;
    container.appendChild(giftEl);

    // 2 áƒ¬áƒáƒ›áƒ¨áƒ˜ áƒ•áƒáƒ¨áƒáƒ áƒ”áƒ‘áƒ— áƒ”áƒšáƒ”áƒ›áƒ”áƒœáƒ¢áƒ¡
    setTimeout(() => giftEl.remove(), 2000);
}
// áƒáƒœáƒ˜áƒ›áƒáƒªáƒ˜áƒ˜áƒ¡ áƒ”áƒ¤áƒ”áƒ¥áƒ¢áƒ˜ (CSS JavaScript-áƒ˜áƒ“áƒáƒœ)
const styleSheet = document.createElement("style");
styleSheet.innerText = `
@keyframes gift-pop-up {
    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
    20% { transform: translate(-50%, -50%) scale(1.5); opacity: 1; }
    80% { transform: translate(-50%, -100%) scale(1.2); opacity: 1; }
    100% { transform: translate(-50%, -200%) scale(1); opacity: 0; }
}`;
document.head.appendChild(styleSheet);



function listenToActiveLives() {
    const floatBtn = document.getElementById('liveFloatingBtn');
    const lastAva = document.getElementById('lastLiveAva');
    const modalList = document.getElementById('modalLivesList');

    db.ref('lives').on('value', snap => {
        const lives = snap.val();
        modalList.innerHTML = "";
        
        if (!lives || Object.keys(lives).length === 0) {
            floatBtn.style.display = 'none';
            return;
        }

        // áƒ•áƒáƒ©áƒ•áƒ”áƒœáƒ”áƒ‘áƒ— áƒ›áƒªáƒ£áƒ áƒáƒ• áƒ¦áƒ˜áƒšáƒáƒ™áƒ¡
        floatBtn.style.display = 'block';
        
        const liveEntries = Object.entries(lives);
        // áƒ‘áƒáƒšáƒ áƒ“áƒáƒ¬áƒ§áƒ”áƒ‘áƒ£áƒšáƒ˜ áƒšáƒáƒ˜áƒ•áƒ˜áƒ¡ áƒáƒ•áƒáƒ¢áƒáƒ áƒ˜ áƒ¦áƒ˜áƒšáƒáƒ™áƒ–áƒ”
        const lastLive = liveEntries[liveEntries.length - 1][1];
        lastAva.src = lastLive.hostPhoto || 'https://ui-avatars.com/api/?name=' + lastLive.hostName;

        // áƒ•áƒáƒ•áƒ¡áƒ”áƒ‘áƒ— áƒ›áƒáƒ“áƒáƒšáƒ¡ áƒšáƒáƒ˜áƒ•áƒ”áƒ‘áƒ˜áƒ—
        liveEntries.forEach(([uid, data]) => {
            const item = document.createElement('div');
            item.style = "display:flex; align-items:center; justify-content:space-between; background:rgba(255,255,255,0.05); padding:10px; border-radius:15px; border:1px solid rgba(212,175,55,0.1);";
            item.innerHTML = `
                <div style="display:flex; align-items:center; gap:12px;">
                    <img src="${data.hostPhoto}" style="width:45px; height:45px; border-radius:50%; border:1px solid var(--gold);">
                    <b style="color:white; font-size:14px;">${data.hostName}</b>
                </div>
                <button onclick="joinLive('${uid}', '${data.channel}'); closeActiveLivesModal();" style="background:var(--gold); border:none; padding:7px 15px; border-radius:10px; font-weight:900; font-size:12px; cursor:pointer;">WATCH</button>
            `;
            modalList.appendChild(item);
        });
    });
}

function openActiveLivesModal() {
    document.getElementById('activeLivesModal').style.display = 'flex';
}

function closeActiveLivesModal() {
    document.getElementById('activeLivesModal').style.display = 'none';
}
 </script>
<div id="communityWallUI" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(15px); z-index: 15000; display: none; flex-direction: column;">
 
 <div style="padding: 15px; border-bottom: 1px solid rgba(212, 175, 55, 0.2); display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.5);">
 <h2 style="color: var(--gold); font-weight: 900; font-size: 18px;">COMMUNITY</h2>
 <i class="fas fa-times" style="font-size: 24px; color: gray; cursor: pointer;" onclick="closeCommunityWall()"></i>
 </div>

 <div style="background: rgba(20,20,20,0.4); padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05);">
 <div style="display: flex; gap: 10px; margin-bottom: 15px;">
 <img id="wallMyAva" src="" style="width: 45px; height: 45px; border-radius: 50%; border: 1px solid var(--gold); object-fit: cover;">
 <textarea id="wallPostText" style="flex: 1; background: transparent; border: none; color: white; resize: none; outline: none; font-size: 16px; padding-top: 5px;" placeholder="áƒ áƒáƒ¡ áƒ¤áƒ˜áƒ¥áƒ áƒáƒ‘?"></textarea>
 </div>
 
 <div id="wallImgPreviewBox" style="display: none; width: 100%; position: relative; margin-bottom: 15px;">
 <img id="wallImgPreview" style="width: 100%; border-radius: 10px; border: 1px solid var(--gold); max-height: 200px; object-fit: cover;">
 <i class="fas fa-times-circle" style="position: absolute; top: 5px; right: 5px; color: white; font-size: 20px; cursor: pointer;" onclick="cancelWallImg()"></i>
 </div>

 <div style="display: flex; justify-content: space-between; align-items: center;">
 <div onclick="document.getElementById('wallImgInput').click()" style="color: var(--gold); cursor: pointer; font-size: 14px; font-weight: bold; background: rgba(212,175,55,0.1); padding: 8px 15px; border-radius: 20px;">
 <i class="fas fa-image"></i> áƒ¤áƒáƒ¢áƒ
 </div>
 <input type="file" id="wallImgInput" accept="image/*" hidden onchange="previewWallImage(this)">
 <button onclick="submitWallPost()" style="background: var(--gold); border: none; padding: 8px 25px; border-radius: 20px; font-weight: bold; cursor: pointer; color: black;">áƒ’áƒáƒ›áƒáƒ¥áƒ•áƒ”áƒ§áƒœáƒ”áƒ‘áƒ</button>
 </div>
 </div>

 <div id="communityPostsList" style="flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 20px; background: transparent;">
 </div>
 
 <div id="videoCallUI" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:99999; flex-direction:column;">
 <div style="position:absolute; top:20px; right:20px; z-index:10; display:flex; gap:15px;">
 <i class="fas fa-compress-alt" onclick="minimizeVideoCall()" style="color:white; font-size:24px; cursor:pointer;" title="áƒ©áƒáƒ™áƒ”áƒªáƒ•áƒ"></i>
 <i class="fas fa-phone-slash" onclick="endVideoCall()" style="color:#ff4d4d; font-size:24px; cursor:pointer;" title="áƒ’áƒáƒ—áƒ˜áƒ¨áƒ•áƒ"></i>
 </div>

 <div id="remote-video" style="width:100%; height:100%; background:#111;"></div>

 <div id="local-video" style="position:absolute; bottom:100px; right:20px; width:120px; height:160px; background:#222; border-radius:12px; border:2px solid var(--gold); overflow:hidden; z-index:5;"></div>
</div>
</div>
</body>
</html>
